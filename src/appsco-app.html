<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">

<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">

<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-ajax/iron-request.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">

<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-out-animation.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-runner-behavior.html">

<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">
<link rel="import" href="../bower_components/paper-styles/color.html">

<link rel="import" href="components/header/appsco-header.html">
<link rel="import" href="components/header/appsco-account-chat.html">
<link rel="import" href="components/components/appsco-api.html">

<link rel="import" href="components/application/appsco-application-add.html">
<link rel="import" href="components/application/appsco-application-share.html">
<link rel="import" href="components/application/appsco-application-remove.html">
<link rel="import" href="components/application/appsco-application-subscriber-revoke.html">
<link rel="import" href="components/application/appsco-application-revoke.html">
<link rel="import" href="components/application/company/appsco-company-application-add.html">
<link rel="import" href="components/application/company/appsco-company-sso-application-add.html">
<link rel="import" href="components/application/company/appsco-company-application-share.html">
<link rel="import" href="components/application/company/appsco-company-application-remove.html">
<link rel="import" href="components/application/company/appsco-application-orgunit.html">
<link rel="import" href="components/application/company/appsco-application-remove-orgunit.html">
<link rel="import" href="components/application/company/appsco-application-assignee-claims.html">
<link rel="import" href="components/application/company/appsco-application-assignee-revoke.html">

<link rel="import" href="components/account/appsco-account-authorized-app-revoke.html">

<link rel="import" href="application/appsco-application-settings-dialog.html">
<link rel="import" href="application/appsco-home-page-actions.html">
<link rel="import" href="application/appsco-application-page-actions.html">
<link rel="import" href="account/appsco-account-page-actions.html">
<link rel="import" href="upgrade/appsco-upgrade-page-actions.html">
<link rel="import" href="company/appsco-company-home-page-actions.html">
<link rel="import" href="applications/appsco-applications-page-actions.html">
<link rel="import" href="applications/appsco-manage-application-page-actions.html">
<link rel="import" href="billing/appsco-billing-page-actions.html">

<link rel="import" href="directory/appsco-directory-page-actions.html">
<link rel="import" href="directory/appsco-manage-account-page-actions.html">
<link rel="import" href="components/account/appsco-invitation-remove.html">
<link rel="import" href="directory/appsco-directory-add-account.html">
<link rel="import" href="directory/appsco-directory-import-accounts.html">

<link rel="import" href="upgrade/appsco-upgrade-action.html">
<link rel="import" href="billing/appsco-subscription-cancel.html">
<link rel="import" href="billing/appsco-credit-card.html">
<link rel="import" href="billing/appsco-billing-send-invoice.html">

<link rel="import" href="vault/appsco-vault-page-actions.html">
<link rel="import" href="vault/appsco-vault-manage-item.html">
<link rel="import" href="components/vault/appsco-vault-remove.html">

<link rel="import" href="components/orgunit/appsco-orgunit-modify.html">
<link rel="import" href="components/orgunit/appsco-orgunit-remove.html">

<link rel="import" href="components/account/company/appsco-account-orgunit.html">
<link rel="import" href="components/account/company/appsco-account-remove-orgunit.html">
<link rel="import" href="components/account/company/appsco-account-remove.html">

<link rel="import" href="auditlog/appsco-audit-log-page-actions.html">

<link rel="import" href="provisioning/appsco-provisioning-settings-page-actions.html">
<link rel="import" href="provisioning/appsco-start-integration.html">

<link rel="import" href="company/appsco-company-page-actions.html">
<link rel="import" href="company/appsco-company-add-domain.html">
<link rel="import" href="company/appsco-company-remove-domain.html">
<link rel="import" href="company/appsco-company-domain-token.html">

<link rel="import" href="application/appsco-dialog-application-add.html">
<link rel="import" href="applications/appsco-dialog-application-company-add.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="webkit-scrollbar-style.html">

<dom-module id="appsco-app">
    <template>
        <style include="shared-styles">
            :host {
                display: block;

                --brand-color: var(--app-primary-color);
                --brand-text-color: #ffffff;
                --brand-default-text-color: #ffffff;

                --app-primary-color: #279FBC;
                --app-primary-color-1: #39C2D7;
                --app-secondary-color: #273441;
                --app-secondary-color-1: #1183A4;
                --app-danger-color: #db4437;
                --app-warning-color: var(--paper-orange-300);
                --body-background-color: #f5f8fa;
                --app-primary-color-dark: #414042;
                --success-color: #5AC099;

                --primary-text-color: #414042;
                --secondary-text-color: #969696;

                --header-background-color: var(--brand-color);
                --header-text-color: var(--brand-text-color);
                --header-icon-color: var(--header-text-color);
                --header-divider-color: var(--header-text-color);

                --appsco-product-text-color: var(--header-text-color);

                --primary-button-background-color: var(--brand-color);

                --border-radius-base: 3px;

                --paper-progress-active-color: var(--success-color);

                --border-color: var(--divider-color);

            }

            /* Top header style START */
            appsco-header {
                height: 64px;
                padding: 16px 10px;
                box-sizing: border-box;
                background-color: var(--header-background-color);

                --appsco-brand: {
                     display: block;
                 };
                --appsco-product: {
                     height: 32px;
                     line-height: 35px;
                 };

                --paper-listbox: {
                     color: var(--app-secondary-color);
                 };

                --notifications-paper-card-header-text: {
                     color: var(--primary-text-color);
                 };

                --appsco-brand-logo: {
                    width: auto;
                }
            }
            /* Top header style END */

            /* Bottom header style START */
            app-header {
                background-color: #ffffff;
                box-shadow: 0 3px 3px -2px rgba(0, 0, 0, 0.4);
            }
            app-header paper-icon-button {
                --paper-icon-button-ink-color: white;
            }
            app-header .actions {
                height: 100%;
            }
            .page-title {
                margin-right: 10px;
                font-size: 18px;
                color: var(--primary-text-color);
                text-transform: capitalize;
            }
            /* Bottom header style END */

            /* Menu list style START */
            .drawer-list {
            }
            .drawer-list > a,
            .drawer-list div[disabled],
            .drawer-list div[head]
            {
                display: block;
                padding: 0 16px;
                text-decoration: none;
                color: var(--app-secondary-color);
                line-height: 36px;
                border-bottom: 1px solid var(--divider-color);
                outline: none;
                font-size: 14px;
            }
            .drawer-list div[head] {
                background-color: #279FBC;
                color: #ffffff;
            }
            .drawer-list div[head].business {
                background-color: #5AC099;
            }
            .drawer-list div[disabled] {
                opacity: 0.4;
            }
            .drawer-list a.iron-selected {
                background-color: var(--google-grey-300);
            }
            /* Menu list style END */

            :host app-drawer-layout[fullbleed] {
                top: 64px;
                overflow: hidden;
            }
            app-drawer {
                top: 64px;
                border-top: 1px solid #ffffff;
                height: calc(100vh - 64px);
                --app-drawer-content-container: {
                     padding-top: 0;
                     background: var(--body-background-color);
                     overflow: auto;
                 };
            }
            app-drawer iron-icon {
                --iron-icon-fill-color: var(--app-primary-color-dark);
            }
            app-toolbar {
                padding: 0 10px;
            }
            :host .flex-horizontal {
                @apply(--layout-horizontal);
                @apply(--layout-center);
            }
            :host .flex {
                @apply(--layout-flex);
            }
            .pages {
                height: 100%;
            }
            .menu-text {
                display: inline-block;
                vertical-align: middle;
                padding-left: 8px;
            }
            paper-progress {
                width: 100%;
                position: absolute;
                top: 64px;
                left: 0;
                z-index: 10;
            }
            paper-progress::shadow #primaryProgress {
                background-color: var(--paper-progress-active-color);
            }
            :host([tablet-screen]) {
                --appsco-paper-dialog: {
                     width: 90%;
                     top: 20vh;
                 };
            }
            :host([mobile-screen]) {
                --appsco-account-notifications-dropdown: {
                     width: 300px;
                 };

                --appsco-account-info-dropdown: {
                     width: 300px;
                 };
            }
            :host div[purchase] {
                margin-top: 20px;
                padding: 0 18px;
                @apply(--layout-vertical);
                @apply(--layout-center);
                @apply(--paper-font-body1);
                color: var(--primary-text-color);
            }
            :host div[purchase] a {
                width: 100%;
            }
            :host div[purchase] paper-button {
                @apply(--primary-button);
                background-color: var(--brand-color);
                border-color: var(--brand-color);
                width: 100%;
                margin-top: 10px;
            }
            :host div[purchase] a {
                display: block;
                text-decoration: none;
                outline: none;
            }
            .toast-close-action {
                position: absolute;
                top: 0;
                right: 2px;
                width: 18px;
                height: 18px;
                margin: 0;
                color: #ffffff;
            }
        </style>

        <iron-media-query query="(max-width: 600px)" query-matches="{{ mobileScreen }}"></iron-media-query>
        <iron-media-query query="(max-width: 800px)" query-matches="{{ tabletScreen }}"></iron-media-query>

        <appsco-api id="api" domain="[[ domain ]]" index="" name="{{ api }}"></appsco-api>
        <app-location route="{{route}}"></app-location>

        <app-route
                route="{{route}}"
                pattern="[[_prefixPath]]/:page"
                data="{{routeData}}"
                tail="{{subroute}}"></app-route>

        <paper-toast id="toast"
                     text="[[ _toastMessage ]]"
                     on-iron-overlay-closed="_onToastMessageClosed">

            <template is="dom-if" if="[[ _toastPersistence ]]">
                <paper-icon-button icon="icons:close"
                                   class="toast-close-action"
                                   on-tap="_onCloseToastAction"></paper-icon-button>
            </template>
        </paper-toast>

        <appsco-header id="appscoHeader"
                account="[[ account ]]"
                brand-logo="[[ _brandLogo ]]"
                brand-logo-width="38"
                brand-logo-height="32"
                brand-title="[[ _brandTitle ]]"
                authorization-token="[[ authorizationToken ]]"
                notifications-api="[[ api.notifications ]]"
                logout-api="[[ api.logout ]]"
                notifications-size="5"
                product-business="[[ account.companies ]]"
                product-partner="[[ account.partner ]]"
                domain="{{ domain }}"
                on-brand-action="_onBrandAction"
                on-vault-action="_onVaultAction"
                on-appsco-product-changed="_onAppscoProductChangeAction"
                on-account-chat="_onAccountChat"
                on-account-settings="_onAccountSettingsAction"
                on-all-notifications="_onAllNotifications"
                on-account-logout="_onAccountLogout"></appsco-header>

        <app-drawer-layout fullbleed force-narrow>

             <!--Drawer content -->
            <app-drawer id="appDrawer">
                <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation">
                    <template is="dom-if" if="[[ !_companyPage ]]">
                        <a name="home" href="/home">
                            <iron-icon icon="icons:home"></iron-icon> <span class="menu-text">Home</span>
                        </a>
                        <!--<a name="vault" href="/vault">-->
                            <!--<iron-icon icon="icons:work"></iron-icon> <span class="menu-text">Vault</span>-->
                        <!--</a>-->
                        <div purchase name="trybusiness" href="/trybusiness">
                            <div>
                                Manage your business applications, employees and get meaningful insights.
                            </div>
                            <a href="/trybusiness" name="trybusiness">
                                <paper-button>
                                    Try Appsco Business
                                </paper-button>
                            </a>
                        </div>
                    </template>

                    <template is="dom-if" if="[[ _companyPage ]]">
                        <template is="dom-if" if="[[ _companyUser ]]">
                            <a name="company-home" href="/company-home">
                                <iron-icon icon="icons:home"></iron-icon> <span class="menu-text">Dashboard</span>
                            </a>
                            <template is="dom-if" if="[[ _companyAdmin ]]">
                                <a name="applications" href="/applications">
                                    <iron-icon icon="icons:apps"></iron-icon> <span class="menu-text">Applications</span>
                                </a>
                                <a name="directory" href="/directory">
                                    <iron-icon icon="icons:supervisor-account"></iron-icon> <span class="menu-text">Directory</span>
                                    <!--icons:folder-shared-->
                                </a>
                                <a name="provisioning" href="/provisioning" >
                                    <iron-icon icon="icons:compare-arrows"></iron-icon> <span class="menu-text">Provisioning</span>
                                </a>
                                <a name="audit-log" href="/audit-log">
                                    <iron-icon icon="icons:reorder"></iron-icon> <span class="menu-text">Audit</span>
                                </a>
                                <a name="statistics" href="/statistics" >
                                    <iron-icon icon="icons:donut-large"></iron-icon> <span class="menu-text">Statistics</span>
                                </a>
                                <a name="billing" href="/billing">
                                    <iron-icon icon="icons:payment"></iron-icon> <span class="menu-text">Billing</span>
                                </a>
                                <a name="company" href="/company">
                                    <iron-icon icon="icons:settings"></iron-icon> <span class="menu-text">Settings</span>
                                </a>
                            </template>
                        </template>
                    </template>

                </iron-selector>
            </app-drawer>

            <!-- Main content -->
            <app-header-layout has-scrolling-region>

                <app-header>
                    <app-toolbar class="flex-horizontal">
                        <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
                        <div class="page-title" condense-title>[[ _pageName ]]</div>

                        <neon-animated-pages
                                id="animatedActions"
                                class="actions flex flex-end"
                                selected="[[page]]"
                                attr-for-selected="name"
                                on-neon-animation-finish="_onPageActionsAnimationFinish">

                            <appsco-home-page-actions id="appscoHomePageActions"
                                    name="home"
                                    on-add-item-action="_onAddItemAction"
                                    on-search="_onSearchApplications"
                                    on-search-clear="_onSearchApplicationsClear"
                                    on-filter-items="_onFilterItems"
                                    on-page-global-info="_onInfoAction"></appsco-home-page-actions>

                            <appsco-application-page-actions
                                    id="appscoApplicationPageActions"
                                    name="application"
                                    on-back="_showHomePage"
                                    on-resource-section="_onResourceActionApplicationPage"
                                    on-search-subscribers="_onSearchSubscribers"
                                    on-search-subscribers-clear="_onSearchSubscribersClear"></appsco-application-page-actions>

                            <appsco-account-page-actions
                                    id="appscoAccountPageActions"
                                    name="account"
                                    on-back="_showHomePage"
                                    on-resource-section="_onResourceActionAccountPage"
                                    on-advanced-settings="_onAccountAdvancedSettings"></appsco-account-page-actions>

                            <appsco-vault-page-actions
                                    name="vault"
                                    authorization-token="[[ authorizationToken ]]"
                                    on-page-global-info="_onInfoVaultAction"
                                    on-add-vault-action="_onAddVaultAction"></appsco-vault-page-actions>

                            <appsco-upgrade-page-actions
                                    name="upgrade"
                                    authorization-token="[[ authorizationToken ]]"
                                    on-toggle-pricing="_onUpgradeTogglePricing"></appsco-upgrade-page-actions>

                            <appsco-company-home-page-actions id="appscoCompanyHomePageActions"
                                                      name="company-home"
                                                      on-page-global-info="_onInfoAction"
                                                      on-search="_onSearchApplications"
                                                      on-search-clear="_onSearchApplicationsClear"></appsco-company-home-page-actions>

                            <appsco-applications-page-actions id="appscoApplicationsPageActions"
                                    name="applications"
                                    authorization-token="[[ authorizationToken ]]"
                                    filter-api="[[ api.dashboards ]]?extended=1"
                                    on-add-item-action="_onAddCompanyItemAction"
                                    on-search="_onSearchCompanyApplications"
                                    on-search-clear="_onSearchCompanyApplicationsClear"
                                    on-page-global-info="_onInfoAction"
                                    on-page-global-filters="_onFiltersAction"
                                    on-share="_onShareApplications"
                                    on-remove="_onRemoveApplications"
                                    on-orgunits="_onAddApplicationsToOrgunit"
                                    on-select-all="_onSelectAllApplications"
                                    on-deselect-all="_onDeselectAllApplications"></appsco-applications-page-actions>

                            <appsco-manage-application-page-actions
                                    id="appscoManageApplicationPageActions"
                                    name="manage-application"
                                    on-back="_showCompanyApplicationsPage"
                                    on-resource-section="_onResourceActionManageApplicationPage"
                                    on-search-assignees="_onSearchAssignees"
                                    on-search-assignees-clear="_onSearchAssigneesClear"></appsco-manage-application-page-actions>

                            <appsco-directory-page-actions
                                    id="appscoDirectoryPageActions"
                                    name="directory"
                                    authorization-token="[[ authorizationToken ]]"
                                    on-add-account="_onCompanyAddAccount"
                                    on-import-accounts="_onCompanyImportAccounts"
                                    on-search="_onSearchAccounts"
                                    on-search-clear="_onSearchAccountsClear"
                                    on-page-global-info="_onInfoAction"
                                    on-page-global-filters="_onFiltersAction"
                                    on-upgrade="_fireUpgrade"
                                    on-remove="_onRemoveAccounts"
                                    on-orgunits="_onAddAccountsToOrgunit"
                                    on-manage-domains="_onManageDomains"
                            ></appsco-directory-page-actions>

                            <appsco-manage-account-page-actions
                                    name="manage-account"
                                    on-back="_showCompanyDirectoryPage"
                                    on-resource-section="_onResourceActionManageAccountPage"></appsco-manage-account-page-actions>

                            <appsco-audit-log-page-actions
                                    name="audit-log"
                                    on-resource-section="_onResourceActionAuditLogPage"></appsco-audit-log-page-actions>

                            <appsco-billing-page-actions
                                    name="billing"
                                    on-resource-section="_onResourceActionBillingPage"></appsco-billing-page-actions>

                            <appsco-provisioning-settings-page-actions
                                    id="appscoProvisioningSettingsPageActions"
                                    name="provisioning-settings"
                                    on-back="_showCompanyProvisioningPage"
                                    on-resource-section="_onResourceActionProvisioningSettingsPage"
                                    on-sync-accounts="_onSyncAccounts"></appsco-provisioning-settings-page-actions>

                            <appsco-company-page-actions
                                    id="appscoCompanyPageActions"
                                    name="company"
                                    on-resource-section="_onResourceActionCompanyPage"
                                    on-add-domain="_onAddDomain"></appsco-company-page-actions>
                        </neon-animated-pages>

                    </app-toolbar>
                </app-header>

                <paper-progress id="pageProgress" indeterminate></paper-progress>

                <neon-animated-pages
                        class="pages"
                        selected="[[page]]"
                        attr-for-selected="name"
                        fallback-selection="404"
                        role="main"
                        on-neon-animation-finish="_onPageAnimationFinish">

                    <appsco-home-page
                            id="appscoHomePage"
                            name="home"
                            application="{{ application }}"
                            application-log="[[ application.meta.log ]]"
                            authorization-token="[[ authorizationToken ]]"
                            applications-api="[[ applicationsApi ]]"
                            on-loaded="_onLoadedApplications"
                            on-edit-application="_onEditApplication"
                            on-info-edit-application="_onInfoEditApplication"
                            on-share-application="_onShareApplication"
                            on-revoke-application="_onRevokeApplication"
                            on-applications-removed="_onApplicationsRemovedFromHomePage"></appsco-home-page>

                    <appsco-application-page
                            id="appscoApplicationPage"
                            name="application"
                            route="[[ subroute ]]"
                            company="[[ _companyPage ]]"
                            application="{{ application }}"
                            applications-api="[[ applicationsApi ]]"
                            application-log="[[ application.meta.log ]]"
                            authorization-token="[[ authorizationToken ]]"
                            accounts-api="[[ api.accounts ]]"
                            account="{{ account }}"
                            on-share-application="_onShareApplication"
                            on-remove-application="_onRemoveApplication"
                            on-subscription-revoke="_onSubscriptionRevoke"
                            on-application-settings-saved="_onApplicationSettingsSaved"
                            on-application-settings-no-changes="_onApplicationSettingsNoChanges"
                            on-autologin-changed="_onAutologinChanged"
                            on-enable-subscribers-search-action="_onEnableSubscribersSearchAction"
                            on-disable-subscribers-search-action="_onDisableSubscribersSearchAction"
                            on-page-error="_onError"></appsco-application-page>

                    <appsco-account-page
                            id="appscoAccountPage"
                            name="account"
                            account="{{ account }}"
                            authorization-token="[[ authorizationToken ]]"
                            notifications-api="[[ api.notifications ]]"
                            authorized-apps-api="[[ api.authorizedApps ]]"
                            log-api="[[ api.accountLog ]]"
                            two-fa-api="[[ api.twoFA ]]"
                            two-fa-qr-api="[[ api.twoFAQr ]]"
                            two-fa-codes-api="[[ api.twoFACodes ]]"
                            settings-api="[[ api.me ]]"
                            image-settings-api="[[ api.profileImage ]]"
                            transfer-token-api="[[ api.transferToken ]]"
                            change-password-api="[[ api.changePassword ]]"
                            partner-api="[[ api.partner ]]"
                            on-settings-saved="_onAccountSettingsSaved"
                            on-password-changed="_onAccountPasswordChanged"
                            on-disable-advanced-settings="_onDisableAdvancedSettings"
                            on-enable-advanced-settings="_onEnableAdvancedSettings"
                            on-twofa-enabled="_onTwoFaEnabled"
                            on-twofa-disabled="_onTwoFaDisabled"
                            on-revoke-authorized-application="_onRevokeAuthorizedApplication"
                            on-token-generated="_onTokenGenerated"></appsco-account-page>

                    <appsco-vault-page
                            id="appscoVaultPage"
                            name="vault"
                            authorization-token="[[ authorizationToken ]]"
                            api="[[ api ]]"
                            on-loaded="_onLoadedVaultItems"
                            on-edit="_onEditVaultAction"
                            on-remove-vault-item="_onRemoveVaultAction">
                    </appsco-vault-page>

                    <appsco-trybusiness-page
                            id="appscoUpgradePage"
                            name="trybusiness"
                            authorization-token="[[ authorizationToken ]]"
                            company-upgrade-api="[[ api.upgradeToBusiness ]]"
                            on-upgraded="_upgradedToBusiness"
                    ></appsco-trybusiness-page>

                    <appsco-company-home-page
                            id="appscoCompanyHomePage"
                            name="company-home"
                            authorization-token="[[ authorizationToken ]]"
                            applications-api="[[ companyIconsApi ]]"
                            on-loaded="_onLoadedApplications"
                    ></appsco-company-home-page>

                    <appsco-applications-page
                            id="appscoApplicationsPage"
                            name="applications"
                            application="{{ _companyApplication }}"
                            application-log="[[ _companyApplication.meta.log ]]"
                            authorization-token="[[ authorizationToken ]]"
                            computed-headers="[[ _computedHeaders ]]"
                            company-applications-api="[[ companyApplicationsApi ]]"
                            company-orgunits-api="[[ companyOrgunitsApi ]]"
                            on-loaded="_onLoadedApplications"
                            on-edit-application="_onEditCompanyApplication"
                            on-info-edit-application="_onInfoEditCompanyApplication"
                            on-share-company-application="_onShareCompanyApplication"
                            on-show-bulk-actions="_onShowBulkActions"
                            on-hide-bulk-actions="_onHideApplicationsBulkActions"
                            on-add-orgunit="_onAddOrgunit"
                            on-modify-orgunit="_onModifyOrgunit"
                            on-remove-orgunit="_onRemoveOrgunit"></appsco-applications-page>

                    <appsco-manage-application-page
                            id="appscoManageApplicationPage"
                            name="manage-application"
                            route="[[ subroute ]]"
                            application="{{ _companyApplication }}"
                            company-api="[[ companyApi ]]"
                            application-log="[[ _companyApplication.meta.log ]]"
                            authorization-token="[[ authorizationToken ]]"
                            accounts-api="[[ api.accounts ]]"
                            account="{{ account }}"
                            on-share-company-application="_onShareCompanyApplication"
                            on-remove-application="_onRemoveCompanyApplication"
                            on-change-assignee-claims="_onChangeAssigneeClaims"
                            on-revoke-assignee="_onRevokeAssigneeAccess"
                            on-application-settings-saved="_onApplicationSettingsSaved"
                            on-claim-type-changed="_onApplicationSettingsSaved"
                            on-sharing-settings-saved="_onApplicationSettingsSaved"
                            on-application-settings-no-changes="_onApplicationSettingsNoChanges"
                            on-add-to-orgunit="_onAddApplicationToOrgunit"
                            on-remove-from-orgunit="_onRemoveApplicationFromOrgunit"
                            on-enable-assignees-search-action="_onEnableAssigneesSearchAction"
                            on-disable-assignees-search-action="_onDisableAssigneesSearchAction"
                            on-page-error="_onError"></appsco-manage-application-page>

                    <appsco-directory-page
                            id="appscoDirectoryPage"
                            name="directory"
                            role="{{ _role }}"
                            selected-accounts="{{ _selectedAccounts }}"
                            authorization-token="[[ authorizationToken ]]"
                            computed-headers="[[ _computedHeaders ]]"
                            company-invitations-api="[[ companyDirectoryInvitationsApi ]]"
                            company-directory-roles-api="[[ companyDirectoryRolesApi ]]"
                            company-orgunits-api="[[ companyOrgunitsApi ]]"
                            domains-api="[[ _domainsApi ]]"
                            on-invitation-resent="_onInvitationResent"
                            on-remove-invitation="_onRemoveInvitation"
                            on-hide-subscription-limit-reached-info="_onHideSubscriptionLimitReachedInfo"
                            on-show-domain-not-verified-info="_onShowDomainNotVerifiedInfo"
                            on-hide-domain-not-verified-info="_onHideDomainNotVerifiedInfo"
                            on-edit-account="_onEditAccount"
                            on-info-edit-account="_onEditAccount"
                            on-show-bulk-actions="_onShowBulkActions"
                            on-hide-bulk-actions="_onHideDirectoryBulkActions"
                            on-add-orgunit="_onAddOrgunit"
                            on-modify-orgunit="_onModifyOrgunit"
                            on-remove-orgunit="_onRemoveOrgunit"></appsco-directory-page>

                    <appsco-manage-account-page
                            id="appscoManageAccountPage"
                            name="manage-account"
                            route="[[ subroute ]]"
                            role="{{ _role }}"
                            administrator="[[ account ]]"
                            authorization-token="[[ authorizationToken ]]"
                            company-api="[[ companyApi ]]"
                            notifications-api="[[ api.notifications ]]"
                            log-api="[[ api.accountLog ]]"
                            two-fa-api="[[ api.twoFA ]]"
                            settings-api="[[ api.me ]]"
                            image-settings-api="[[ api.profileImage ]]"
                            change-password-api="[[ api.changePassword ]]"
                            on-settings-saved="_onAccountSettingsSaved"
                            on-password-changed="_onCompanyAccountPasswordChanged"
                            on-add-to-orgunit="_onAddAccountToOrgunit"
                            on-remove-from-orgunit="_onRemoveAccountFromOrgunit"
                            on-account-role-changed="_onAccountRoleChanged"
                            on-page-error="_onError"
                            on-assignee-claims="_onChangeAssigneeClaims"
                            on-revoke-assignee="_onRevokeAssigneeAccess"
                    ></appsco-manage-account-page>

                    <appsco-provisioning-page
                            id="appscoProvisioningPage"
                            name="provisioning"
                            company-api="[[ companyApi ]]"
                            authorization-token="[[ authorizationToken ]]"
                            on-available-integration="_onStartAuthorization"
                            on-active-integration="_onIntegrationSetup"
                    ></appsco-provisioning-page>

                    <appsco-provisioning-settings-page
                            id="appscoProvisioningSettingsPage"
                            name="provisioning-settings"
                            authorization-token="[[ authorizationToken ]]"
                            integration="[[ _selectedIntegration ]]"
                            company-roles-api="[[ companyDirectoryRolesApi ]]"
                            on-back="_showCompanyProvisioningPage"
                            on-local-account-synced="_onLocalAccountSynced"
                            on-new-account-synced="_onNewAccountSynced"
                            on-accounts-sync-finished="_onAccountsSyncFinished"
                            on-synced-account-removed="_onSyncedAccountRemoved"
                            on-initialize-page="_onInitializeProvisioningPage"
                            on-reset-page="_onResetProvisioningPage"
                            on-show-bulk-actions="_onShowBulkActionsProvisioningPage"
                            on-hide-bulk-actions="_onHideBulkActionsProvisioningPage"
                    ></appsco-provisioning-settings-page>

                    <appsco-provisioning-integration-authorization-success-page
                            id="appscoProvisioningIntegrationSuccessPage"
                            name="provisioning-integration-authorization-success"
                            on-provisioning="_showCompanyProvisioningPage"
                    ></appsco-provisioning-integration-authorization-success-page>

                    <appsco-provisioning-integration-authorization-failed-page
                            id="appscoProvisioningIntegrationFailedPage"
                            name="provisioning-integration-authorization-failed"
                            on-provisioning="_showCompanyProvisioningPage"
                    ></appsco-provisioning-integration-authorization-failed-page>

                    <appsco-audit-log-page
                            id="appscoAuditLogPage"
                            name="audit-log"
                            authorization-token="[[ authorizationToken ]]"
                            company-api="[[ companyApi ]]"></appsco-audit-log-page>

                    <appsco-statistics-page
                            id="appscoStatisticsPage"
                            name="statistics"
                            company-api="[[ companyApi ]]"
                            authorization-token="[[ authorizationToken ]]"
                    ></appsco-statistics-page>

                    <appsco-billing-page
                            id="appscoBillingPage"
                            name="billing"
                            company-api="[[ companyApi ]]"
                            account="[[ account ]]"
                            authorization-token="[[ authorizationToken ]]"
                            on-manage-credit-card="_onManageCreditCard"
                            on-send-invoice="_onSendInvoice"></appsco-billing-page>

                    <appsco-company-page
                            id="appscoCompanyPage"
                            name="company"
                            company="{{ currentCompany.company }}"
                            authorization-token="[[ authorizationToken ]]"
                            computed-headers="[[ _computedHeaders ]]"
                            brand-logo="[[ _brandLogo ]]"
                            on-company-settings-changed="_onCompanySettingsChanged"
                            on-company-brand-settings-changed="_onCompanyBrandSettingsChanged"
                            on-company-logo-changed="_onCompanyLogoChanged"
                            on-show-domains-page-actions="_onShowDomainsPageActions"
                            on-hide-domains-page-actions="_onHideDomainsPageActions"
                            on-remove-domain="_onRemoveDomain"
                            on-get-token="_onDomainGetToken"
                            on-domain-verified="_onDomainVerified"
                            on-domain-not-verified="_onDomainNotVerified"
                    ></appsco-company-page>

                    <appsco-logout-page name="logout"
                                        logout-api="[[ api.logout ]]"></appsco-logout-page>

                    <appsco-not-found-page name="404"></appsco-not-found-page>
                </neon-animated-pages>
            </app-header-layout>
        </app-drawer-layout>

        <appsco-account-chat
                id="appscoAccountChat"
                account="{{ account }}"
                chat="{{ chat }}"
                dont-close-outside>
        </appsco-account-chat>

        <appsco-application-add
                id="appscoApplicationAdd"
                authorization-token="[[ authorizationToken ]]"
                applications-template-api="[[ api.applicationTemplates ]]"
                dashboard-api="[[ _addAppApi ]]"
                link-api="[[ api.link ]]"
                item-api="[[ api.item ]]"
                on-application-added="_onApplicationAdded"
                on-link-added="_onApplicationAdded">
        </appsco-application-add>

        <appsco-application-share
                id="appscoApplicationShare"
                application="[[ application ]]"
                authorization-token="[[ authorizationToken ]]"
                accounts-api="[[ api.accounts ]]"
                on-application-shared="_onApplicationShared"
                ></appsco-application-share>

        <appsco-application-settings-dialog
                id="appscoApplicationSettingsDialog"
                account="[[ account ]]"
                authorization-token="[[ authorizationToken ]]"
                application="[[ application ]]"
                on-application-settings-saved="_onApplicationCredentialsChanged"
        ></appsco-application-settings-dialog>

        <appsco-application-remove
                id="appscoApplicationRemove"
                application="[[ application ]]"
                authorization-token="[[ authorizationToken ]]"
                on-application-removed="_onApplicationRemoved"></appsco-application-remove>

        <appsco-account-authorized-app-revoke
                id="appscoAccountAuthorizedAppRevoke"
                application="[[ _authorizedApplication ]]"
                authorization-token="[[ authorizationToken ]]"
                on-application-revoked="_onAuthorizedApplicationRevoked"></appsco-account-authorized-app-revoke>

        <appsco-application-subscriber-revoke
                id="appscoApplicationSubscriberRevoke"
                authorization-token="[[ authorizationToken ]]"
                on-subscription-revoked="_onSubscriptionRevoked"
        ></appsco-application-subscriber-revoke>

        <appsco-application-revoke
                id="appscoApplicationRevoke"
                authorization-token="[[ authorizationToken ]]"
                on-application-instance-removed="_onApplicationInstanceRevoked"
        ></appsco-application-revoke>

        <appsco-vault-remove
                id="appscoVaultItemRemove"
                authorization-token="[[ authorizationToken ]]"
                on-vault-item-removed="_onVaultItemRemoved"
        ></appsco-vault-remove>

        <appsco-vault-manage-item
                id="appscoVaultItemManage"
                authorization-token="[[ authorizationToken ]]"
                api="[[ api ]]"
                on-item-saved="_onItemSaved"
        ></appsco-vault-manage-item>

        <appsco-orgunit-modify
                id="appscoOrgunitModify"
                authorization-token="[[ authorizationToken ]]"
                on-orgunit-added="_onOrgunitAdded"
                on-orgunit-modified="_onOrgunitModified"
                ></appsco-orgunit-modify>

        <appsco-orgunit-remove
                id="appscoOrgunitRemove"
                authorization-token="[[ authorizationToken ]]"
                on-orgunit-removed="_onOrgunitRemoved"
                ></appsco-orgunit-remove>

        <appsco-company-application-add
                id="appscoCompanyApplicationsAdd"
                authorization-token="[[ authorizationToken ]]"
                applications-template-api="[[ api.applicationTemplates ]]"
                add-application-api="[[ companyApplicationsApi ]]"
                link-api="[[ api.link ]]"
                item-api="[[ api.item ]]"
                on-application-added="_onCompanyApplicationAdded">
        </appsco-company-application-add>

        <appsco-company-sso-application-add
                id="appscoCompanySSOApplicationsAdd"
                authorization-token="[[ authorizationToken ]]"
                applications-template-api="[[ api.applicationTemplates ]]"
                add-application-api="[[ companyApplicationsApi ]]"
                link-api="[[ api.link ]]"
                item-api="[[ api.item ]]"
                on-application-added="_onCompanyApplicationAdded">
        </appsco-company-sso-application-add>

        <appsco-application-orgunit
                id="appscoApplicationOrgunit"
                authorization-token="[[ authorizationToken ]]"
                company-orgunits-api="[[ companyOrgunitsApi ]]"
                applications="[[ _selectedApplications ]]"
                on-added-to-orgunit="_onApplicationsAddedToOrgunit"></appsco-application-orgunit>

        <appsco-application-remove-orgunit
                id="appscoApplicationRemoveOrgunit"
                authorization-token="[[ authorizationToken ]]"
                application="[[ _companyApplication ]]"
                on-application-removed-from-orgunit="_onApplicationRemovedFromOrgunit"></appsco-application-remove-orgunit>

        <appsco-company-application-share
                id="appscoCompanyApplicationsShare"
                applications="[[ _applicationsToShare ]]"
                authorization-token="[[ authorizationToken ]]"
                accounts-api="[[ api.accounts ]]"
                on-applications-shared="_onCompanyApplicationsShared"
                ></appsco-company-application-share>

        <appsco-application-assignee-claims
                id="appscoApplicationAssigneeClaims"
                application="[[ _companyApplication ]]"
                authorization-token="[[ authorizationToken ]]"
                on-claims-changed="_onAssigneeClaimsChanged"
                ></appsco-application-assignee-claims>

        <appsco-application-assignee-revoke
                id="appscoApplicationAssigneeRevoke"
                authorization-token="[[ authorizationToken ]]"
                on-access-revoked="_onAssigneeAccessRevoked"
                ></appsco-application-assignee-revoke>

        <appsco-company-application-remove
                id="appscoCompanyApplicationsRemove"
                applications="[[ _selectedApplications ]]"
                authorization-token="[[ authorizationToken ]]"
                company-api="[[ companyApi ]]"
                on-applications-removed="_onApplicationsRemoved"
                on-applications-remove-failed="_onApplicationsRemoveFailed"></appsco-company-application-remove>

        <appsco-invitation-remove
                id="appscoInvitationRemove"
                authorization-token="[[ authorizationToken ]]"
                on-invitation-removed="_onInvitationRemoved"
                on-invitation-already-removed="_onInvitationAlreadyRemoved">
        </appsco-invitation-remove>

        <appsco-directory-add-account
                id="appscoDirectoryAccountAdd"
                authorization-token="[[ authorizationToken ]]"
                directory-invitations-api="[[ companyDirectoryInvitationsApi ]]"
                on-invitation-created="_onInvitationCreated"
                on-account-added="_onAccountAdded">
        </appsco-directory-add-account>

        <appsco-directory-import-accounts
                id="appscoDirectoryImportAccounts"
                authorization-token="[[ authorizationToken ]]"
                directory-import-api="[[ companyDirectoryImportAccounts ]]"
                domain="[[ domain ]]"
                on-account-import-finished="_onAccountImportFinished">
        </appsco-directory-import-accounts>

        <appsco-account-orgunit
                id="appscoAccountOrgunit"
                authorization-token="[[ authorizationToken ]]"
                company-orgunits-api="[[ companyOrgunitsApi ]]"
                accounts="[[ _selectedAccounts ]]"
                on-added-to-orgunit="_onAccountsAddedToOrgunit"></appsco-account-orgunit>

        <appsco-account-remove-orgunit
                id="appscoAccountRemoveOrgunit"
                authorization-token="[[ authorizationToken ]]"
                account="[[ _role ]]"
                on-account-removed-from-orgunit="_onAccountRemovedFromOrgunit"></appsco-account-remove-orgunit>

        <appsco-account-remove
                id="appscoAccountsRemove"
                accounts="[[ _selectedAccounts ]]"
                authorization-token="[[ authorizationToken ]]"
                company-api="[[ companyApi ]]"
                on-accounts-removed="_onAccountsRemoved"
                on-accounts-remove-failed="_onAccountsRemoveFailed"></appsco-account-remove>

        <appsco-upgrade-action
                id="appscoUpgradeAction"
                authorization-token="[[ authorizationToken ]]"
                company-api="[[ companyApi ]]"
                on-subscription-changed="_onSubscriptionChanged">
        </appsco-upgrade-action>

        <appsco-subscription-cancel
                id="appscoSubscriptionCancel"
                authorization-token="[[ authorizationToken ]]"
                company-api="[[ companyApi ]]"
                on-subscription-canceled="_onSubscriptionCanceled">
        </appsco-subscription-cancel>

        <appsco-credit-card
                id="appscoCreditCard"
                authorization-token="[[ authorizationToken ]]"
                company-api="[[ companyApi ]]"
                on-credit-card-added="_onCreditCardAdded">
        </appsco-credit-card>

        <appsco-billing-send-invoice
                id="appscoBillingSendInvoice"
                company="[[ currentCompany ]]"
                authorization-token="[[ authorizationToken ]]"
                company-api="[[ companyApi ]]"
                on-invoice-sent="_onInvoiceSent">
        </appsco-billing-send-invoice>

        <appsco-start-integration
                id="appscoStartIntegration"
                account="[[ account ]]"
                authorization-token="[[ authorizationToken ]]"
                company-api="[[ companyApi ]]">
        </appsco-start-integration>

        <appsco-company-add-domain
                id="appscoCompanyAddDomain"
                authorization-token="[[ authorizationToken ]]"
                add-domain-api="[[ _domainsApi ]]"
                on-domain-added="_onDomainAdded">
        </appsco-company-add-domain>

        <appsco-company-remove-domain
                id="appscoCompanyRemoveDomain"
                authorization-token="[[ authorizationToken ]]"
                domains-api="[[ _domainsApi ]]"
                on-domain-removed="_onDomainRemoved"></appsco-company-remove-domain>

        <appsco-dialog-application-add
                id="appscoDialogApplicationAdd"
                authorization-token="[[ authorizationToken ]]"
                dashboard-api="[[ _addAppApi ]]"
                on-application-added="_onApplicationAdded"
        ></appsco-dialog-application-add>

        <appsco-dialog-application-company-add
                id="appscoDialogApplicationCompanyAdd"
                authorization-token="[[ authorizationToken ]]"
                add-application-api="[[ companyApplicationsApi ]]"
                on-application-added="_onCompanyApplicationAdded"
        ></appsco-dialog-application-company-add>

        <appsco-company-domain-token
                id="appscoCompanyDomainToken"></appsco-company-domain-token>

        <template is="dom-if" if="[[ api.me ]]">
            <iron-ajax auto
                       url="[[ api.me ]]"
                       on-response="_onGetAccountResponse"
                       on-error="_onGetAccountError"
                       headers="[[ _computedHeaders ]]"></iron-ajax>
        </template>

        <template is="dom-if" if="[[ api.dashboards ]]">
            <iron-ajax id="getDashboardsLink"
                       url="[[ api.dashboards ]]?extended=1"
                       on-response="_onDashboardsResponse"
                       headers="[[ _computedHeaders ]]"></iron-ajax>
        </template>

        <iron-ajax auto
                   url="[[ _subscriptionApi ]]"
                   headers="[[ _computedHeaders ]]"
                   handle-as="json"
                   on-response="_onSubscriptionResponse"></iron-ajax>
    </template>

    <script>
        Polymer({
            is: 'appsco-app',

            properties: {

                _companyPage: {
                    type: Boolean,
                    computed: '_computeCompany(page)'
                },

                page: {
                    type: String,
                    observer: '_pageChanged'
                },

                _prefixPath: {
                    type: String,
                    computed: '_computePrefixPath(domain)'
                },

                domain: {
                    type: String
                },

                _pageName: {
                    type: String,
                    computed: '_computePageName(page)'
                },

                api: {
                    type: Object,
                    value: function () { return {}; },
                    notify: true
                },

                account: {
                    type: Object,
                    value: function() {
                        return {};
                    },
                    notify: true
                },

                _role: {
                    type: Object,
                    value: function() {
                        return {};
                    }
                },

                /**
                 * Computed headers.
                 * It contains authorization token.
                 */
                _computedHeaders: {
                    type: Object,
                    computed: "_computeHeaders(authorizationToken)"
                },

                chat: {
                    type: Object,
                    value: function() {
                        return {
                            auth: "auth code",
                            room: "room number",
                            service: "https://www.xxx.com",
                            active: "false"
                        }
                    }
                },

                /**
                 * Selected application.
                 */
                application: {
                    type: Object,
                    value: function() {
                        return {};
                    }
                },

                currentCompany: {
                    type: Object,
                    value: function() {
                        return {};
                    },
                    notify: true,
                    observer: '_onCurrentCompanyChanged'
                },

                /**
                 * Selected company application.
                 */
                _companyApplication: {
                    type: Object,
                    value: function() {
                        return {};
                    }
                },

                /**
                 * Selected applications (company).
                 */
                _selectedApplications: {
                    type: Array,
                    value: function() {
                        return [];
                    }
                },

                /**
                 * Company applications to share.
                 */
                _applicationsToShare: {
                    type: Array,
                    value: function() {
                        return [];
                    }
                },

                /**
                 * Selected authorized application that is to be removed.
                 */
                _authorizedApplication: {
                    type: Object,
                    value: function() {
                        return {};
                    },
                    notify: true
                },

                /**
                 * Selected accounts (company).
                 */
                _selectedAccounts: {
                    type: Array,
                    value: function() {
                        return [];
                    }
                },

                /**
                 * Selected integration for provisioning settings
                 */
                _selectedIntegration: {
                    type: Object,
                    value: function() { return {}; }
                },

                /**
                 * Authorization token for logged account.
                 */
                authorizationToken: {
                    type: String,
                    value: ''
                },

                _addAppApi: {
                    type: String,
                    value: ''
                },

                applicationsApi: {
                    type: String,
                    value: ''
                },

                companyApplicationsApi: {
                    type: String,
                    value: ''
                },

                companyDirectoryInvitationsApi: {
                    type: String,
                    value: ''
                },

                companyDirectoryRolesApi: {
                    type: String,
                    value: ''
                },

                companyOrgunitsApi: {
                    type: String,
                    value: ''
                },

                companyIconsApi: {
                    type: String,
                    value: ''
                },

                companyApi: {
                    type: String,
                    value: ''
                },

                _subscriptionApi: {
                    type: String,
                    computed: '_computeSubscriptionApi(companyApi)'
                },

                _domainsApi: {
                    type: String,
                    computed: '_computeDomainsApi(companyApi)'
                },

                _subscription: {
                    type: Object,
                    value: function() {
                        return {};
                    }
                },

                _globalActions: {
                    type: Boolean,
                    value: true
                },

                _selectedApplicationsGroup: {
                    type: Number,
                    value: 0
                },

                _toastMessage: {
                    type: String,
                    value: ''
                },

                _toastPersistence: {
                    type: Boolean,
                    value: false
                },

                mobileScreen: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },

                tabletScreen: {
                    type: Boolean,
                    value: false,
                    reflectToAttribute: true
                },

                _companyUser: {
                    type: Boolean,
                    computed: "_computeCompanyUser(account)"
                },

                _companyAdmin: {
                    type: Boolean,
                    computed: "_computeCompanyAdmin(account, currentCompany)"
                },

                _brandLogo: {
                    type: String,
                    computed: '_computeBrandLogo(currentCompany, _companyPage)'
                },

                _brandTitle: {
                    type: String,
                    computed: '_computeBrandTitle(currentCompany, _companyPage)'
                }
            },

            observers: [
                '_updateScreen(mobileScreen, tabletScreen)',
                '_routePageChanged(routeData.page)',
                '_changeTheme(_companyPage, currentCompany)'
            ],

            listeners: {
                'page-loaded': '_onPageLoaded',
                'filter-done': '_onPageLoaded',
                'upgrade-active': '_fireUpgrade',
                'cancel-subscription': '_onCancelSubscription',
                'reload-account-log': '_onReloadAccountLog',
                'info-edit-application-credentials': '_onEditApplicationCredentials',
                'reload-applications': '_onReloadApplications',
                'reload-accounts': '_onReloadAccounts',
                'application-settings-saved': '_onApplicationUpdated',
                'show-subscription-limit-reached-info': '_onShowSubscriptionLimitReachedInfo',
                'copied-application-attribute': '_onCopiedApplicationAttribute',
                'claim-type-changed': '_onApplicationClaimTypeChanged'
            },

            attached: function() {

                if (this.mobileScreen || this.tabletScreen) {
                    this.updateStyles();
                }

            },

            _updateScreen: function(mobile, tablet) {
                this.updateStyles();
            },

            _computePrefixPath: function (domain) {

                if(window.location.href.includes('localhost')) {
                    return '';
                }

                if (domain.includes('/app.php')) {
                    return '/app.php';
                }

                if (domain.includes('/app_dev.php')) {
                    return '/app_dev.php';
                }

                return '';
            },

            _onCurrentCompanyChanged: function(company) {

                if (company && company.company) {
                    document.cookie = 'company=' + company.company.alias;

                    this._setCompanyApi(company.company.self);

                    if (this._companyPage) {
                        this._setProduct(true);
                    }
                }
                else {
                    this._setProduct(false);
                }
            },

            _computeCompanyUser: function(account) {
                return account && account.companies && account.companies.length != 0;
            },

            _computeCompanyAdmin: function(account, currentCompany) {
                if (account.companies && currentCompany.company) {
                    for (var i = 0; i < account.companies.length; i++) {
                        if (account.companies[i].company.alias == currentCompany.company.alias) {
                            return account.companies[i].company_admin;
                        }
                    }
                }
                return false;
            },

            _setProduct: function(company) {
                var appscoHeader = this.$.appscoHeader;

                company ? appscoHeader.setProduct('appsco-business-product' + this.currentCompany.company.alias) : appscoHeader.setProduct('appsco-product');
            },

            /**
             * Routing START
             */
            _routePageChanged: function(page) {
                this.page = page || 'home';
            },

            _pageChanged: function(page) {

                this._setProgressBar(page);

                // Load page import on demand. Show 404 page if fails
                var resolvedPageUrl = this.resolveUrl('appsco-' + page + '-page.html');

                this.importHref(resolvedPageUrl, null, this._showPage404, true);

                this.$.appDrawer.close();
            },

            _computePageName: function(page) {

                switch (page) {
                    case 'manage-application':
                        return 'Manage Application';

                    case 'manage-account':
                        return 'Manage Account';

                    case 'company-home':
                        return 'Dashboard';

                    case 'company':
                        return 'Company Settings';

                    case 'provisioning-settings':
                        return 'Provisioning > Setup';

                    case 'provisioning-integration-authorization-success':
                        return 'Provisioning > Authorization success';

                    case 'provisioning-integration-authorization-failed':
                        return 'Provisioning > Authorization failed';

                    case 'audit-log':
                        return 'Audit Log';

                    case 'trybusiness':
                        return 'Try Appsco Business';

                    default:
                        return page;
                }

            },

            _showHomePage: function() {
                this.set('routeData.page', 'home');
            },

            _showVaultPage: function() {
                this.set('routeData.page', 'vault');
            },

            _showAccountPage: function() {
                this.set('routeData.page', 'account');
            },

            _showCompanyHomePage: function() {
                this.set('routeData.page', 'company-home');
            },

            _showCompanyPage: function() {
                this.set('routeData.page', 'company');
            },

            _showCompanyApplicationsPage: function() {
                this.set('routeData.page', 'applications');
            },

            _showCompanyDirectoryPage: function() {
                this.set('routeData.page', 'directory');
            },

            _showCompanyProvisioningPage: function() {
                this.set('routeData.page', 'provisioning');
            },

            _showLogoutPage: function() {
                this.set('routeData.page', 'logout');
            },

            _showPage404: function() {
                this.page = '404';
                this._pageName = 'Not Found';
            },
            /**
             * Routing END
             */

            /**
             * Ajax START
             */
            /**
             * Computes authorization headers.
             *
             * @param {Object} authorizationToken
             * @returns {{ Authorization: string }}
             * @private
             */
            _computeHeaders: function (authorizationToken) {
                return {
                    'Authorization': 'token ' + authorizationToken
                }
            },

            _computeSubscriptionApi: function(companyApi) {
                return companyApi ? companyApi + '/billing/subscription' : '';
            },

            _computeDomainsApi: function(companyApi) {
                return companyApi ? companyApi + '/domains' : '';
            },

            _onGetAccountResponse: function(event) {
                var account = event.detail.response.account;

                this.account = account;
                this.$$('#getDashboardsLink').generateRequest();

                if (account.companies.length > 0) {
                    var companies = account.companies,
                        length = companies.length,
                        currentCompany = companies[0],
                        companyAlias = this._getCookie('company');

                    if (companyAlias && companyAlias.length > 0) {

                        for (var i = 0; i < length; i++) {
                            if (companies[i].company.alias == companyAlias) {
                                currentCompany = companies[i];
                            }
                        }
                    }

                    this.currentCompany = currentCompany;
                }

            },

            _onGetAccountError: function() {
//                this._showPage404();
            },

            _setGetApplicationsApi: function() {
                this.applicationsApi = this.api.icons;
            },

            _createDefaultDashboard: function() {
                var request = document.createElement('iron-request'),
                    options = {
                        url: this.api.dashboards,
                        method: 'POST',
                        handleAs: 'json',
                        headers: {
                            'Authorization': 'token ' + this.authorizationToken,
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: 'dashboard[title]=' + encodeURIComponent(this.account.name)
                    };

                request.send(options).then(function() {

                    if (200 == request.status) {
                        this._addAppApi = request.response.dashboard.self;
                        this._setGetApplicationsApi();
                    }

                }.bind(this));
            },

            _onDashboardsResponse: function(event) {
                var response = event.detail.response;

                if (response && response.meta.total > 0) {
                    var dashboards = response.dashboards,
                        length = dashboards.length,
                        hasDashboard = false;

                    dashboardsLoop:
                    for (var i = 0; i < length; i++) {
                        var dashboardRoles = dashboards[i].roles,
                            rolesLength = dashboardRoles.length;

                        for (var j = 0; j < rolesLength; j++) {
                            if ('owner' === dashboardRoles[j].toLowerCase()) {
                                this._addAppApi = dashboards[i].self;
                                this._setGetApplicationsApi();
                                hasDashboard = true;
                                break dashboardsLoop;
                            }
                        }

                    }

                    if (!hasDashboard) {
                        this._createDefaultDashboard();
                    }
                }
                else {
                    this._createDefaultDashboard();
                }
            },

            _onSubscriptionResponse: function(event) {
                var status = event.detail.status,
                    response = event.detail.response;

                if (200 === status && response) {
                    this._subscription = response;
                    this._setSubscription(response);
                    this._evaluateSubscriptionLicences();
                }
            },

            _setCompanyApi: function(company) {

                this.companyApi = company;
                this.companyApplicationsApi = company + '/applications';
                this.companyDirectoryInvitationsApi = company + '/invitation';
                this.companyDirectoryRolesApi = company + '/directory/roles';
                this.companyDirectoryImportAccounts = company + '/directory/roles/import';
                this.companyOrgunitsApi = company + '/org-units?extended=1';
                this.companyIconsApi = this.currentCompany.icons;
            },

            /**
             * Ajax END
             */

            /**
             * Appsco header actions START
             */
            _onBrandAction: function() {
                this._companyPage ? this._showCompanyHomePage() : this._showHomePage();
            },

            _onVaultAction: function() {
                this._setProduct(false);
                this._showVaultPage();
            },

            _onAppscoProductChangeAction: function(event) {
                var panel = event.detail.product;

                if ('appsco-product' === panel && 'home' !== this.page) {
                    this._showHomePage();
                }

                if ('appsco-business-product' === panel) {
                    this.currentCompany = event.detail.company;
                    this._showCompanyHomePage();
                }

            },

            _onAccountChat: function(event) {
                this.$.appscoAccountChat.toggleChat(event.target);
            },

            _onAccountSettingsAction: function() {
                this._setProduct(false);
                this._showAccountPage();
            },

            _onAllNotifications: function() {
                this.$.appscoAccountPage.showAllNotifications = true;
                this._showAccountPage();
                this._setProduct(false);
            },

            _onAccountLogout: function() {
                this._showLogoutPage();
            },
            /**
             * Appsco header actions END
             */

            /**
             * Home page START
             */
            _onLoadedApplications: function(event) {
                var page = event.target;

                if (page.$ && ('home' === this.page || 'company-home' === this.page || 'applications' === this.page)) {
                    page.initializePage();
                }

            },

            getCurrentAppscoPageElement: function() {
                switch (this.page) {
                    case 'home':
                        return this.$.appscoHomePage;
                        break;

                    case 'company-home':
                        return this.$.appscoCompanyHomePage;
                        break;

                    case 'applications':
                        return this.$.appscoApplicationsPage;
                        break;

                    case 'directory':
                        return this.$.appscoDirectoryPage;
                        break;

                    case 'company':
                        return this.$.appscoCompanyPage;
                        break;
                }
            },

            getCurrentAppscoPageActionsElement: function() {

                switch (this.page) {
                    case 'home':
                        return this.$.appscoHomePageActions;
                        break;
                    case 'applications':
                        return this.$.appscoApplicationsPageActions;
                        break;
                    case 'directory':
                        return this.$.appscoDirectoryPageActions;
                        break;
                }

            },

            _onInfoAction: function() {
                this.getCurrentAppscoPageElement().toggleInfo();
            },

            _onFiltersAction: function() {
                this.getCurrentAppscoPageElement().toggleResource();
            },

            _onShowBulkActions: function() {
                this.getCurrentAppscoPageActionsElement().showBulkActions();
            },

            _onHideApplicationsBulkActions: function() {
                this.$.appscoApplicationsPageActions.hideBulkActions();
            },

            _onHideDirectoryBulkActions: function() {
                this.$.appscoDirectoryPageActions.hideBulkActions();
            },

            _onInfoVaultAction: function() {
                this.$.appscoVaultPage.toggleInfo();
            },

            _onSearchApplications: function(event) {
                this._showProgressBar();
                this.getCurrentAppscoPageElement().filterApplicationsByTerm(event.detail.term);
            },

            _onSearchApplicationsClear: function() {
                this.getCurrentAppscoPageElement().filterApplicationsByTerm('');
            },

            _onFilterItems: function(event) {
                var id = parseInt(event.detail.id);

                if (id !== this._selectedApplicationsGroup) {
                    this._selectedApplicationsGroup = id;
                    this._showProgressBar();

                    switch (id) {
                        case 1:
                            this.applicationsApi = this.api.personalItems;
                            break;

                        case 2:
                            this.applicationsApi = this.api.sharedWithMeItems;
                            break;

                        default:
                            this.applicationsApi = this.api.icons;
                    }
                }

            },

            _onAddItemAction: function(event) {
                var action = event.detail.action,
                    applicationTemplate = event.detail.applicationTemplate;

                switch (action) {
                    case 'catalogue-application':
                        this.$.appscoApplicationAdd.toggle();
                        break;
                    default:
                        var request = document.createElement('iron-request'),
                            options = {
                                url: this.domain + applicationTemplate,
                                method: 'GET',
                                handleAs: 'json',
                                headers: {
                                    'Authorization': 'token ' + this.authorizationToken
                                }
                            };

                        request.send(options).then(function() {

                            if (200 == request.status) {
                                this.$.appscoDialogApplicationAdd.setApplicationTemplate(request.response.application);
                                this.$.appscoDialogApplicationAdd.toggle();
                            }

                        }.bind(this));
                        break;
                }
            },

            _onApplicationAdded: function(event) {
                var application = event.detail.application,
                    applications = [application],
                    message = application.title + ' was successfully saved.';

                this.application = application;
                this.$.appscoHomePage.addApplications(applications);
                this._notify(message);
            },

            _onEditApplication: function() {
                this.set('route.path', 'application/' + this.application.alias);
            },

            _onInfoEditApplication: function() {
                this._onEditApplication();
            },

            _onEditApplicationCredentials: function(event) {
                this.$.appscoApplicationSettingsDialog.setApplication(event.detail.application);
                this.$.appscoApplicationSettingsDialog.toggle();
            },

            _reloadHomePageApplications: function() {

                if (this.$.appscoHomePage.$) {
                    this.$.appscoHomePage.reloadApplications();
                }
            },
            /**
             * Home page END
             */

            /**
             * Application page START
             */
            _onApplicationUpdated: function(event) {
                var application = event.detail.application;

                switch (this.page) {
                    case 'home':
                    case 'application':
                        this.set('application', {});
                        this.set('application', application);

                        if (this.$.appscoHomePage.$) {
                            this.$.appscoHomePage.setApplication(application);
                        }

                        break;

                    case 'company-home':
                        this.set('_companyApplication', {});
                        this.set('_companyApplication', application);

                        if (this.$.appscoCompanyHomePage.$) {
                            this.$.appscoCompanyHomePage.setApplication(application);
                        }

                        this._reloadCompanyApplications();

                        break;

                    case 'manage-application':
                        this.set('_companyApplication', {});
                        this.set('_companyApplication', application);

                        this._reloadCompanyHomePageApplications();
                        this._reloadCompanyApplications();

                        break;
                }
            },

            _onResourceActionApplicationPage: function() {
                this.$.appscoApplicationPage.toggleResource();
            },

            _onEnableSubscribersSearchAction: function() {
                this.$.appscoApplicationPageActions.enableSubscribersSearchAction();
            },

            _onDisableSubscribersSearchAction: function() {
                this.$.appscoApplicationPageActions.disableSubscribersSearchAction();
            },

            _searchSubscribers: function(term) {
                this._showProgressBar();
                this.$.appscoApplicationPage.searchSubscribers(term);
            },

            _onSearchSubscribers: function(event) {
                this._searchSubscribers(event.detail.term);
            },

            _onSearchSubscribersClear: function() {
                this._searchSubscribers('');
            },

            _onShareApplication: function() {
                this.$.appscoApplicationShare.toggle();
            },

            _onApplicationShared: function(event) {
                var application = event.detail.application,
                    applicationLogApi = application.meta.log,
                    message = 'You successfully shared ' + this.application.title + '.';

                // In order to notify.
                this.set('application', {});
                this.set('application', application);

                this._notifyAboutApplicationLogChange(applicationLogApi);
                this._notify(message);
            },

            _onApplicationCredentialsChanged: function(event) {
                var application = event.detail.application,
                    message = 'You successfully changed ' + application.title + ' credentials.';

                this._notify(message);
            },

            _onApplicationClaimTypeChanged: function() {
                if (this.$.appscoApplicationsPage.$) {
                    this.$.appscoApplicationsPage.reloadApplications();
                }
            },

            _onRemoveApplication: function() {
                this.$.appscoApplicationRemove.open();
            },

            _onApplicationRemoved: function(event) {
                var application = event.detail.application,
                    applications = [application],
                    message = application.title + ' was successfully removed.';

                if (this.$.appscoHomePage.$) {
                    this.$.appscoHomePage.removeApplications(applications);
                } else {
                    this._showHomePage();
                }

                this._notify(message);

                this._notifyAccountLog();
            },

            _onApplicationSettingsSaved: function(event) {
                var application = event.detail.application,
                    applicationLogApi = application.meta.log,
                    message = application.title + ' was successfully changed.';

                this._notifyAboutApplicationLogChange(applicationLogApi);
                this._notify(message);
            },

            _onApplicationSettingsNoChanges: function(event) {
                this._notify('No changes have been made to ' + event.detail.application.title + '.');
            },

            _onAutologinChanged: function() {
                this._notifyReloadApplications();
            },

            _onReloadApplications: function() {

                switch (this.page) {
                    case 'application':
                        this._reloadHomePageApplications();

                        break;

                    case 'applications':
                        this._reloadHomePageApplications();
                        this._reloadCompanyHomePageApplications();

                        break;

                    case 'manage-application':
                        this._reloadCompanyApplications();
                        this._reloadCompanyHomePageApplications();

                        break;
                }

            },

            /**
             * Notifies application log api change.
             * Used to notify appsco-application-log to load log again.
             *
             * @param String applicationLogApi
             * @private
             */
            _notifyAboutApplicationLogChange: function(applicationLogApi) {
                this.set('application.meta.log', '');
                this.set('application.meta.log', applicationLogApi);
            },

            _onSubscriptionRevoke: function(event) {
                this.$.appscoApplicationSubscriberRevoke.application =   event.detail.application;
                this.$.appscoApplicationSubscriberRevoke.revokeAccount = event.detail.account;

                this.$.appscoApplicationSubscriberRevoke.open();
            },

            _onRevokeApplication: function(event) {
                this.$.appscoApplicationRevoke.applicationInstance = event.detail.application;
                this.$.appscoApplicationRevoke.open();
            },

            _onSelfSubscriptionRevoked: function(event) {
                this.$.appscoHomePage.removeApplications([event.detail.application]);
                this.$.appscoHomePage.setDefaultApplication();
                this._notify('You have successfully revoked access to ' + event.detail.application.title + '.');
            },

            _onAccountSubscriptionRevoked: function(event) {
                this.set('application', {});
                this.set('application', event.detail.application);
                this._notify('You have successfully revoked access to ' + event.detail.application.title + ' for ' + event.detail.account.name);
            },

            _onSubscriptionRevoked: function(event) {

                switch (this.page) {
                    case 'home':
                        this._onSelfSubscriptionRevoked(event);
                        break;

                    case 'application':
                        this._onAccountSubscriptionRevoked(event);
                        break;
                }

            },

            _onApplicationInstanceRevoked: function(event) {
                this.$.appscoHomePage.removeApplications([event.detail.applicationInstance]);
                this.$.appscoHomePage.setDefaultApplication();
                this._notify('You have successfully revoked access to ' + event.detail.applicationInstance.application.title + '.');

            },

            _onApplicationsRemovedFromHomePage: function() {
                this._showHomePage();

                this._notifyReloadApplications();
            },

            /**
             * Application page END
             */

            /**
             * Account page START
             */
            _onResourceActionAccountPage: function() {
                this.$.appscoAccountPage.toggleResource();
            },

            _onAccountAdvancedSettings: function() {
                this.$.appscoAccountPage._onAccountAdvancedSettings();
            },

            _onAccountSettingsSaved: function(event) {

                switch (this.page) {
                    case 'manage-account':
                        this._notify('Account settings for ' + event.detail.account.name + ' were successfully changed.');

                        break;

                    case 'account':
                        this._notify('Account settings were successfully changed.');

                        break;
                }

                this._notifyReloadAccounts();
            },

            _onAccountPasswordChanged: function() {
                this._notify('Account password was successfully changed.');

                this._notifyReloadAccounts();
            },

            _onRevokeAuthorizedApplication: function(event) {
                this._authorizedApplication = event.detail.application;
                this.$.appscoAccountAuthorizedAppRevoke.open();
            },

            _onAuthorizedApplicationRevoked: function(event) {
                var application = event.detail.application;

                this._authorizedApplication = {};
                this._notify(application.title + ' was successfully revoked.');
                this.$.appscoAccountPage.reloadAuthorizedApplications();

                this._notifyAccountLog();
                this._notifyReloadAccounts();
            },

            _onDisableAdvancedSettings: function() {
                this.$.appscoAccountPageActions.disableAdvancedSettings();
            },

            _onEnableAdvancedSettings: function() {
                this.$.appscoAccountPageActions.enableAdvancedSettings();
            },

            _onTwoFaEnabled: function() {
                this._notify("Two-factor authentication enabled.");

                this._notifyReloadAccounts();
            },

            _onTwoFaDisabled: function() {
                this._notify("Two-factor authentication disabled.");

                this._notifyReloadAccounts();
            },

            _onReloadAccountLog: function() {
                if (this.$.appscoAccountPage.$) {
                    this.$.appscoAccountPage.reloadLog();
                }
            },

            _onTokenGenerated: function() {
                this._notify("Transfer token was successfully generated.");
            },
            /**
             * Account page END
             */

            /**
             * Vault page START
             */
            _onLoadedVaultItems: function() {

                if (this.page === 'vault') {
                    this.$.appscoVaultPage.setDefaultItem();
                }

            },

            _onAddVaultAction: function(event) {
                var appscoVaultItemManage = this.$.appscoVaultItemManage;

                appscoVaultItemManage.open(event.detail.action);
            },

            _onEditVaultAction: function(event) {
                var appscoVaultItemManage = this.$.appscoVaultItemManage;

                appscoVaultItemManage.set('item', event.detail.item);
                appscoVaultItemManage.open(event.detail.item.vaultType);
            },

            _onRemoveVaultAction: function(event) {
                var appscoVaultItemRemove = this.$.appscoVaultItemRemove;

                appscoVaultItemRemove.item = event.detail.item;
                appscoVaultItemRemove.open();
            },

            _onItemSaved: function(event) {
                var item = event.detail.item,
                    appscoVaultPage = this.$.appscoVaultPage;

                appscoVaultPage.item = item;
                appscoVaultPage.setItem(item);
                this._notify('Vault item ' + item.displayTitle + ' has been successfully saved.');
            },

            _onVaultItemRemoved: function(event) {
                var appscoVaultPage = this.$.appscoVaultPage;

                appscoVaultPage.removeItem(event.detail.item);
                appscoVaultPage.hideInfo();
                appscoVaultPage.setDefaultItem();
                this._notify('Vault item ' + event.detail.item.displayTitle + ' removed.');

            },
            /**
             * Vault page END
             */

            /**
             * Upgrade page START
             */
            _onUpgradeTogglePricing: function() {
                this.$.appscoUpgradePage.togglePricing();
            },
            /**
             * Upgrade page END
             */

            /**
             * Applications page START
             */
            _filterCompanyApplicationsByTerm: function(term) {
                this._showProgressBar();
                this.$.appscoApplicationsPage.filterApplicationsByTerm(term);
            },

            _onSearchCompanyApplications: function(event) {
                this._filterCompanyApplicationsByTerm(event.detail.term);
            },

            _onSearchCompanyApplicationsClear: function() {
                this._filterCompanyApplicationsByTerm('');
            },

            _onResourceActionManageApplicationPage: function() {
                this.$.appscoManageApplicationPage.toggleResource();
            },

            _searchAssignees: function(term) {
                this._showProgressBar();
                this.$.appscoManageApplicationPage.searchAssignees(term);
            },

            _onSearchAssignees: function(event) {
                this._searchAssignees(event.detail.term);
            },

            _onSearchAssigneesClear: function() {
                this._searchAssignees('');
            },

            _onEditCompanyApplication: function() {
                this.set('route.path', 'manage-application/' + this._companyApplication.alias);
            },

            _onInfoEditCompanyApplication: function() {
                this._onEditCompanyApplication();
            },

            _refreshOrgunits: function(data) {
                var applicationsPage = this.$.appscoApplicationsPage.$ ? this.$.appscoApplicationsPage : null,
                    directoryPage = this.$.appscoDirectoryPage.$ ? this.$.appscoDirectoryPage : null;

                switch (data.event) {
                    case 'orgunit-added':

                        if (null != applicationsPage) {
                            applicationsPage.addOrgunit(data.orgunit);
                        }

                        if (null != directoryPage) {
                            directoryPage.addOrgunit(data.orgunit);
                        }

                        break;

                    case 'orgunit-modified':

                        if (null != applicationsPage) {
                            applicationsPage.modifyOrgunit(data.orgunit);
                        }

                        if (null != directoryPage) {
                            directoryPage.modifyOrgunit(data.orgunit);
                        }

                        break;

                    case 'orgunit-removed':

                        if (null != applicationsPage) {
                            applicationsPage.removeOrgunit(data.orgunit);
                        }

                        if (null != directoryPage) {
                            directoryPage.removeOrgunit(data.orgunit);
                        }

                        break;
                }

            },

            _onAddOrgunit: function(event) {
                var orgunitAddDialog = this.$.appscoOrgunitModify;

                orgunitAddDialog.parent = event.detail.orgUnit;
                orgunitAddDialog.orgUnit = {};
                orgunitAddDialog.open();
            },

            _onOrgunitAdded: function(event) {
                var orgunit = event.detail.orgUnit;

                this._refreshOrgunits({
                    page: this.page,
                    event: event.type,
                    orgunit: orgunit
                });

                this._notify('Organization unit ' + orgunit.name + ' successfully added.');

                this._notifyAccountLog();
            },

            _onModifyOrgunit: function(event) {
                var orgunitModifyDialog = this.$.appscoOrgunitModify;

                orgunitModifyDialog.parent = {};
                orgunitModifyDialog.orgUnit = event.detail.orgUnit;
                orgunitModifyDialog.open();
            },

            _onOrgunitModified: function(event) {
                var orgunit = event.detail.orgUnit;

                this._refreshOrgunits({
                    page: this.page,
                    event: event.type,
                    orgunit: orgunit
                });

                this._notify('Organization unit ' + orgunit.name + ' successfully modified.');

                this._notifyAccountLog();
            },

            _onRemoveOrgunit: function(event) {
                var orgunitRemoveDialog = this.$.appscoOrgunitRemove;

                orgunitRemoveDialog.orgUnit = event.detail.orgUnit;
                orgunitRemoveDialog.open();
            },

            _onOrgunitRemoved: function(event) {
                var orgunit = event.detail.orgUnit;

                this._refreshOrgunits({
                    page: this.page,
                    event: event.type,
                    orgunit: orgunit
                });

                this._notify('Organization unit ' + orgunit.name + ' successfully removed.');

                this._notifyAccountLog();
            },

            _onAddCompanyItemAction: function(event) {
                var action = event.detail.action,
                    applicationTemplate = event.detail.applicationTemplate;

                switch (action) {
                    case 'sso-application':
                        this.$.appscoCompanySSOApplicationsAdd.toggle();
                        break;
                    case 'catalogue-application':
                        this.$.appscoCompanyApplicationsAdd.toggle();
                        break;
                    default:
                        var request = document.createElement('iron-request'),
                            options = {
                                url: this.domain + applicationTemplate,
                                method: 'GET',
                                handleAs: 'json',
                                headers: {
                                    'Authorization': 'token ' + this.authorizationToken
                                }
                            };

                        request.send(options).then(function() {

                            if (200 == request.status) {
                                this.$.appscoDialogApplicationCompanyAdd.setApplicationTemplate(request.response.application);
                                this.$.appscoDialogApplicationCompanyAdd.toggle();
                            }

                        }.bind(this));
                        break;
                }
            },

            _onCompanyApplicationAdded: function(event) {
                var application = event.detail.application,
                    applications = [application],
                    message = application.title + ' was successfully saved.';

                this.$.appscoApplicationsPage.addApplications(applications);
                this._notify(message);
            },

            _addApplicationsToOrgunit: function(applications) {

                if (applications.length > 0) {
                    this.set('_selectedApplications', applications);
                    this.$.appscoApplicationOrgunit.toggle();
                }
            },

            _onAddApplicationsToOrgunit: function() {
                var selectedApplications = this.$.appscoApplicationsPage.getSelectedApplications();

                this._addApplicationsToOrgunit(selectedApplications);
            },

            _onApplicationsAddedToOrgunit: function(event) {
                var applications = event.detail.applications,
                    orgunit = event.detail.orgunit;

                if (applications.length === 1) {
                    this._companyApplication = applications[0];
                }

                this._notify('Selected applications were successfully added to ' + orgunit.name + '.');
                this._modifyCompanyApplications(applications);
                this._reloadCompanyHomePageApplications();
                this._reloadHomePageApplications();
                this._notifyAccountLog();
                this._notifyReloadApplications();
                this._notifyReloadAccounts();
                this._reloadApplicationAssignees();
            },

            _onShareApplications: function() {
                var selectedApplications = this.$.appscoApplicationsPage.getSelectedApplications();

                if (selectedApplications.length > 0) {
                    this.set('_applicationsToShare', selectedApplications);
                    this.$.appscoCompanyApplicationsShare.toggle();
                }
            },

            _onShareCompanyApplication: function(event) {
                this.set('_applicationsToShare', []);
                this._applicationsToShare.push(event.detail.application);
                this.$.appscoCompanyApplicationsShare.toggle();
            },

            _onCompanyApplicationsShared: function(event) {
                var applications = event.detail.applications,
                    application = applications[applications.length - 1];

                this.set('_companyApplication', {});
                this.set('_companyApplication', application);

                this.resetApplicationAssigneesPage();

                this._notify('Selected applications were successfully shared.');

                this._notifyReloadApplications();
            },

            resetApplicationAssigneesPage: function() {

                if (this.$.appscoManageApplicationPageActions.$) {
                    this.$.appscoManageApplicationPageActions.resetApplicationAssigneesPageActions();
                }
            },

            _reloadApplicationAssignees: function() {

                if (this.$.appscoManageApplicationPage.$) {
                    this.$.appscoManageApplicationPage.reloadAssignees();
                }
            },

            _modifyCompanyApplications: function(applications) {

                if (this.$.appscoApplicationsPage.$) {
                    this.$.appscoApplicationsPage.modifyApplications(applications);
                }
            },

            _reloadCompanyHomePageApplications: function() {

                if (this.$.appscoCompanyHomePage.$) {
                    this.$.appscoCompanyHomePage.reloadApplications();
                }
            },

            _reloadCompanyApplications: function() {

                if (this.$.appscoApplicationsPage.$) {
                    this.$.appscoApplicationsPage.reloadApplications();
                }
            },

            _onChangeAssigneeClaims: function(event) {
                var assigneeClaimsComponent = this.$.appscoApplicationAssigneeClaims;

                assigneeClaimsComponent.setApplication(event.detail.application);
                assigneeClaimsComponent.setAssignee(event.detail.assignee);
                assigneeClaimsComponent.toggle();
            },

            _onAssigneeClaimsChanged: function(event) {
                this.set('_companyApplication', {});
                this.set('_companyApplication', event.detail.application);

                this._notify('Claims for ' + event.detail.assignee.display_name + ' were successfully changed.');

                this._notifyReloadAccounts();
            },

            _onRevokeAssigneeAccess: function(event) {
                var assigneeRevokeComponent = this.$.appscoApplicationAssigneeRevoke;

                assigneeRevokeComponent.setAssignee(event.detail.assignee);
                assigneeRevokeComponent.toggle();
            },

            _onAssigneeAccessRevoked: function(event) {
                var application = event.detail.application;

                this._notify('Access for ' + event.detail.assignee.display_name + ' on ' + application.title + ' revoked.');
                this.set('_companyApplication', {});
                this.set('_companyApplication', application);

                this.resetApplicationAssigneesPage();

                if (this.$.appscoManageAccountPage.$) {
                    this.$.appscoManageAccountPage.reloadApplications();
                }

                this._notifyReloadApplications();
                this._notifyReloadAccounts();
            },

            _removeApplications: function(applications) {

                if (applications.length > 0) {
                    this.set('_selectedApplications', applications);
                    this.$.appscoCompanyApplicationsRemove.toggle();
                }
            },

            _onRemoveApplications: function() {
                var selectedApplications = this.$.appscoApplicationsPage.getSelectedApplications();

                this._removeApplications(selectedApplications);
            },

            _onApplicationsRemoved: function(event) {
                this.set('_selectedApplications', []);

                if (this.$.appscoApplicationsPage.$) {
                    this.$.appscoApplicationsPage.removeApplications(event.detail.applications);
                }

                this._showCompanyApplicationsPage();
                this._notify('Selected applications were successfully removed from company.');

                this._notifyReloadApplications();
            },

            _onApplicationsRemoveFailed: function() {
                this.set('_selectedApplications', []);
                this._notify('An error occurred. Selected applications were not removed from company. Please try again.');
            },

            _onSelectAllApplications: function() {
                this.$.appscoApplicationsPage.selectAllApplications();
            },

            _onDeselectAllApplications: function() {
                this.$.appscoApplicationsPage.deselectAllApplications();
                this._onHideApplicationsBulkActions();

            },

            _onRemoveCompanyApplication: function(event) {
                this._removeApplications([event.detail.application]);
            },

            _onAddApplicationToOrgunit: function(event) {
                this._addApplicationsToOrgunit([event.detail.application]);
            },

            _onRemoveApplicationFromOrgunit: function(event) {
                this.$.appscoApplicationRemoveOrgunit.orgunit = event.detail.orgunit;
                this._companyApplication = event.detail.application;
                this.$.appscoApplicationRemoveOrgunit.toggle();
            },

            _onApplicationRemovedFromOrgunit: function(event) {
                var application = event.detail.application,
                    orgunit = event.detail.orgunit;

                this._modifyCompanyApplications([application]);
                this._reloadApplicationAssignees();

                this._companyApplication = application;
                this._notify(application.title + ' has been removed from ' + orgunit.name + ' organization unit.');

                this._notifyReloadApplications();
            },

            _onEnableAssigneesSearchAction: function() {
                this.$.appscoManageApplicationPageActions.enableAssigneesSearchAction();
            },

            _onDisableAssigneesSearchAction: function() {
                this.$.appscoManageApplicationPageActions.disableAssigneesSearchAction();
            },
            /**
             * Applications page END
             */

            /**
             * Directory page START
             */
            _onInvitationResent: function(event) {
                this._notify('Invitation for account ' + event.detail.invitation.email + ' has been sent.');
            },

            _onRemoveInvitation: function(event) {
                var invitationDeleteComponent = this.$.appscoInvitationRemove;

                invitationDeleteComponent.setInvitation(event.detail.invitation);
                invitationDeleteComponent.open();
            },

            _onInvitationRemoved: function(event) {
                var invitation = event.detail.invitation;

                this.$.appscoDirectoryPage.removeInvitations([invitation]);
                this._notify('Invitation for account ' + invitation.email + ' has been removed.');

            },

            _onInvitationAlreadyRemoved: function(event) {
                var invitation = event.detail.invitation;

                this.$.appscoDirectoryPage.removeInvitations([invitation]);
                this._notify('Invitation for account ' + invitation.email + ' has already been removed.');
            },

            _evaluateSubscriptionLicences: function() {

                if (this.$.appscoDirectoryPage.$) {
                    this.$.appscoDirectoryPage.evaluateSubscriptionLicences();
                }
            },

            _searchAccounts: function(term) {
                this._showProgressBar();
                this.$.appscoDirectoryPage.filterAccountsByTerm(term);
            },

            _onSearchAccounts: function(event) {
                this._searchAccounts(event.detail.term);
            },

            _onSearchAccountsClear: function() {
                this._searchAccounts('');
            },

            _onCompanyAddAccount: function() {
                this.$.appscoDirectoryAccountAdd.toggle();
            },

            _onCompanyImportAccounts: function() {
                this.$.appscoDirectoryImportAccounts.toggle();
            },

            _onInvitationCreated: function(event) {
                this.$.appscoDirectoryPage.addInvitations([event.detail.invitation]);
                this._notify('Invitation for account ' + event.detail.invitation.email + ' was successfully created.');
            },

            _onAccountAdded: function(event) {
                this.$.appscoDirectoryPage.addAccounts([event.detail.role]);
                this._reloadProvisioningIntegrationAccounts();
                this._notify('Account ' + event.detail.role.account.email + ' was successfully added.');
            },

            _onAccountImportFinished: function(event) {
                var response = event.detail.response,
                    message;

                message = response.numberOfRoles + ' accounts imported out of ' + response.total + '.'
                        + ' Number of invitations created: ' + response.numberOfInvitations + '.'
                        + ' Number of failed imports: ' + response.numberOfFailed + '.';

                if (0 < response.numberOfRoles) {
                    this._reloadCompanyAccounts();
                    this._reloadProvisioningIntegrationAccounts();
                }

                if (0 < response.numberOfInvitations) {
                    this._reloadCompanyInvitations();
                }

                if (response.maxSubscriptionSizeReached) {
                    this._showSubscriptionLimitReachedInfo(this._subscription);
                }

                this._notify(message, true);
                this._notifyAccountLog();
            },

            _addAccountsToOrgunit: function(accounts) {

                if (accounts.length > 0) {
                    this.set('_selectedAccounts', accounts);
                    this.$.appscoAccountOrgunit.toggle();
                }
            },

            _onAddAccountsToOrgunit: function() {
                var selectedAccounts = this.$.appscoDirectoryPage.getSelectedAccounts();

                this._addAccountsToOrgunit(selectedAccounts);
            },

            _onAccountsAddedToOrgunit: function(event) {
                var accounts = event.detail.accounts,
                    length = accounts.length;

                this._notify('Selected accounts were successfully added to ' + event.detail.orgunit.name + '.');

                if (this.$.appscoDirectoryPage.$) {
                    this.$.appscoDirectoryPage.modifyAccounts(accounts);
                }

                if (accounts.length === 1) {
                    this._role = accounts[0];
                }

                for (var i = 0; i < length; i++) {
                    if (accounts[i].account.email === this.account.email) {
                        this._reloadHomePageApplications();
                        break;
                    }
                }

                this._notifyAccountLog();
                this._notifyReloadApplications();
                this._notifyReloadAccounts();
            },

            _onRemoveAccounts: function() {
                var selectedAccounts = this.$.appscoDirectoryPage.getSelectedAccounts();

                if (selectedAccounts.length > 0) {
                    this.set('_selectedAccounts', selectedAccounts);
                    this.$.appscoAccountsRemove.toggle();
                }
            },

            _onAccountsRemoved: function(event) {
                this.$.appscoDirectoryPage.removeAccounts(event.detail.accounts);
                this._onHideDirectoryBulkActions();
                this.set('_selectedAccounts', []);
                this._reloadProvisioningIntegrationAccounts();
                this._notify('Selected accounts were successfully removed from company.');

                this._notifyAccountLog();
            },

            _onAccountsRemoveFailed: function() {
                this.set('_selectedAccounts', []);
                this._notify('An error occurred. Selected accounts were not removed from company. Please try again.');
            },

            _onManageDomains: function() {
                this.$.appscoCompanyPage.showDomainsPage = true;
                this._showCompanyPage();
            },

            _reloadCompanyAccounts: function() {
                if (this.$.appscoDirectoryPage.$) {
                    this.$.appscoDirectoryPage.reloadAccounts();
                }
            },

            _reloadCompanyInvitations: function() {
                if (this.$.appscoDirectoryPage.$) {
                    this.$.appscoDirectoryPage.reloadInvitations();
                }
            },

            _onReloadAccounts: function() {

                switch (this.page) {
                    case 'manage-account':
                        this._reloadCompanyAccounts();
                        break;

                    default:
                        break;
                }
            },

            _showSubscriptionLimitReachedInfo: function(subscription) {

                this.fire('show-subscription-limit-reached-info', {
                    subscription: subscription
                });
            },
            /**
             * Directory page END
             */

            /**
             * Manage Account page START
             */
            _onShowSubscriptionLimitReachedInfo: function(event) {
                this.$.appscoDirectoryPageActions.showSubscriptionLimitReachedInfo(event.detail.subscription);
            },

            _onHideSubscriptionLimitReachedInfo: function() {
                this.$.appscoDirectoryPageActions.hideSubscriptionLimitReachedInfo();
            },

            _onShowDomainNotVerifiedInfo: function() {
                this.$.appscoDirectoryPageActions.showDomainNotVerifiedInfo();
            },

            _onHideDomainNotVerifiedInfo: function() {
                this.$.appscoDirectoryPageActions.hideDomainNotVerifiedInfo();
            },

            _onEditAccount: function(event) {
                var role = event.detail.role,
                    routePath = 'manage-account/' + role.alias;

                this.set('_role', role);
                this.set('route.path', routePath);
            },

            _onResourceActionManageAccountPage: function() {
                this.$.appscoManageAccountPage.toggleResource();
            },

            _onCompanyAccountPasswordChanged: function(event) {
                this._notify('Password for ' + event.detail.account.name + ' was successfully changed.');

                this._notifyReloadAccounts();
            },

            _onAddAccountToOrgunit: function(event) {
                this._addAccountsToOrgunit([event.detail.role]);
            },

            _onRemoveAccountFromOrgunit: function(event) {
                this.$.appscoAccountRemoveOrgunit.orgunit = event.detail.orgunit;
                this._role = event.detail.account;
                this.$.appscoAccountRemoveOrgunit.toggle();
            },

            _onAccountRemovedFromOrgunit: function(event) {
                var role = event.detail.account;

                if (role.account.email === this.account.email) {
                    this._reloadHomePageApplications();
                }

                if (this.$.appscoDirectoryPage.$) {
                    this.$.appscoDirectoryPage.modifyAccounts([role]);
                }

                this._role = role;
                this._notify(role.account.name + ' has been removed from ' + event.detail.orgunit.name + ' organization unit.');

                this._notifyAccountLog();
                this._notifyReloadApplications();
                this._notifyReloadAccounts();
            },

            _onAccountRoleChanged: function(event) {
                var accountName = event.detail.account.account.name,
                    role = event.detail.role,
                    message = '';

                if (role.value) {
                    message = role.name + ' role is given to ' + accountName + '.';
                }
                else {
                    message = role.name + ' role is revoked from ' + accountName + '.';
                }

                this._notify(message);

                this._notifyReloadAccounts();
            },
            /**
             * Manage Account page END
             */

            /**
             * Audit Log page START
             */
            _onResourceActionAuditLogPage: function() {
                this.$.appscoAuditLogPage.toggleResource();
            },
            /**
             * Audit Log page END
             */

            /**
             * Billing page START
             */
            _onResourceActionBillingPage: function() {
                this.$.appscoBillingPage.toggleResource();
            },

            _fireUpgrade: function() {
                this.$.appscoUpgradeAction.toggle();
            },

            _setSubscription: function(subscription) {

                if (this.$.appscoBillingPage.$) {
                    this.$.appscoBillingPage.setSubscription(subscription);
                }

                if (this.$.appscoDirectoryPage.$) {
                    this.$.appscoDirectoryPage.setSubscription(subscription);
                }
                else {
                    this.$.appscoDirectoryPage.subscription = subscription;
                    this.$.appscoDirectoryPage.subscriptionLoaded = true;
                }
            },

            _onSubscriptionChanged: function(event) {
                this._setSubscription(event.detail.subscription);
                this._reloadProvisioningIntegrationAccounts();
                this._evaluateSubscriptionLicences();
                this._notify('Subscription has been successfully changed.');
            },

            _onCancelSubscription: function() {
                this.$.appscoSubscriptionCancel.toggle();
            },

            _onSubscriptionCanceled: function(event) {
                this._setSubscription(event.detail.subscription);
                this._notify('Subscription has been successfully canceled.');
            },

            _onManageCreditCard: function() {
                this.$.appscoCreditCard.toggle();
            },

            _onCreditCardAdded: function(event) {
                this.$.appscoBillingPage.setCreditCard(event.detail.credit_card);
                this._notify('Credit card has been successfully saved.');
            },

            _onSendInvoice: function(event) {
                this.$.appscoBillingSendInvoice.setInvoice(event.detail.invoice);
                this.$.appscoBillingSendInvoice.toggle();
            },

            _onInvoiceSent: function(event) {
                this._notify('Invoice has been sent to ' + event.detail.sentTo + '.');
            },
            /**
             * Billing page END
             */

            /**
             * Provisioning page START
             */
            _onStartAuthorization: function(event) {
                this.$.appscoStartIntegration.setIntegration(event.detail.integration);
                this.$.appscoStartIntegration.toggle();
            },

            _onIntegrationSetup: function(event) {
                this._selectedIntegration = event.detail.integration;
                this.set('routeData.page', 'provisioning-settings');
            },

            _onResourceActionProvisioningSettingsPage: function() {
                this.$.appscoProvisioningSettingsPage.toggleResource();
            },

            _onLocalAccountSynced: function(event) {
                this._reloadCompanyAccounts();
                this._notify('Remote account ' + event.detail.item.remoteAccount.display_name + ' was successfully synced with ' + event.detail.item.localAccount.account.display_name + ' AppsCo account.');
            },

            _onNewAccountSynced: function(event) {
                this._reloadCompanyAccounts();
                this._notify('Remote account ' + event.detail.item.remoteAccount.display_name + ' was successfully imported.');
            },

            _onAccountsSyncFinished: function(event) {
                this._reloadCompanyAccounts();
                this._notify('Selected accounts were successfully synced.');
            },

            _onSyncAccounts: function() {
                this.$.appscoProvisioningSettingsPage.syncAccounts();
            },

            _reloadProvisioningIntegrationAccounts: function() {

                if (this.$.appscoProvisioningSettingsPage.$) {
                    this.$.appscoProvisioningSettingsPage.reloadAccounts();
                }
            },

            _onSyncedAccountRemoved: function(event) {
                this._notify('Synced account ' + event.detail.item.remoteAccount.display_name + ' was successfully removed.');
            },

            _onInitializeProvisioningPage: function() {
                this.$.appscoProvisioningSettingsPageActions.initializePage();
            },

            _onResetProvisioningPage: function() {
                this.$.appscoProvisioningSettingsPageActions.resetPage();
            },

            _onShowBulkActionsProvisioningPage: function() {
                this.$.appscoProvisioningSettingsPageActions.showBulkActions();
            },

            _onHideBulkActionsProvisioningPage: function() {
                this.$.appscoProvisioningSettingsPageActions.hideBulkActions();
            },
            /**
             * Provisioning page END
             */

            /**
             * Company page START
             */
            _onResourceActionCompanyPage: function() {
                this.getCurrentAppscoPageElement().toggleResource();
            },

            _onCompanySettingsChanged: function(event) {
                this._setAccountCompany(event.detail.company);
                this._notify('Company settings were successfully saved.');
            },

            _onCompanyBrandSettingsChanged: function(event) {
                this._setAccountCompany(event.detail.company);
                this._notify('Company brand settings were successfully saved.');
            },

            _onCompanyLogoChanged: function(event) {
                this._setAccountCompany(event.detail.company);
                this._notify('Company logo was successfully saved.');

                this._notifyAccountLog();
            },

            _upgradedToBusiness: function(e) {
                this.account = {};
                this.account = e.detail.account;

                this.currentCompany = this.account.companies[this.account.companies.length - 1];
                this._setProduct(true);

                this.set('routeData.page', 'company');
                this._notify('Upgrade to AppsCo business succeeded.');

                setTimeout(function() {
                    this._notify('Please setup your company settings.');
                }.bind(this), 2000);
            },

            _onShowDomainsPageActions: function() {
                this.$.appscoCompanyPageActions.showDomainsPageActions();
            },

            _onHideDomainsPageActions: function() {
                this.$.appscoCompanyPageActions.hideDomainsPageActions();
            },

            _onAddDomain: function() {
                this.$.appscoCompanyAddDomain.open();
            },

            _onDomainAdded: function(event) {
                var domain = event.detail.domain;

                if (this.$.appscoDirectoryPage.$) {
                    this.$.appscoDirectoryPage.evaluateDomainVerification({
                        domain: domain,
                        added: true,
                        removed: false
                    });
                }

                this.$.appscoCompanyPage.addDomain(domain);
                this._notify('Domain ' + domain.domain + ' was successfully saved.');
            },

            _onRemoveDomain: function(event) {
                this.$.appscoCompanyRemoveDomain.setDomain(event.detail.domain);
                this.$.appscoCompanyRemoveDomain.open();
            },

            _onDomainRemoved: function(event) {
                var domain = event.detail.domain;

                if (this.$.appscoDirectoryPage.$) {
                    this.$.appscoDirectoryPage.evaluateDomainVerification({
                        domain: domain,
                        added: false,
                        removed: true
                    });
                }

                this.$.appscoCompanyPage.removeDomain(domain);
                this._notify('Domain ' + domain.domain + ' was successfully removed.');
            },

            _onDomainGetToken: function(event) {
                this.$.appscoCompanyDomainToken.setDomain(event.detail.domain);
                this.$.appscoCompanyDomainToken.open();
            },

            _onDomainVerified: function(event) {
                var domain = event.detail.domain;

                if (this.$.appscoDirectoryPage.$) {
                    this.$.appscoDirectoryPage.hideDomainNotVerifiedInfo();
                }

                this.$.appscoCompanyPage.modifyDomain(domain);
                this._notify('Domain ' + domain.domain + ' was successfully verified.');
            },

            _onDomainNotVerified: function(event) {
                var domain = event.detail.domain;

                this._notify('Unable to verify ' + domain.domain + ' domain - please wait until the DNS record change is propagated.', true);
            },
            /**
             * Company page END
             */

            /**
             * Global START
             */
            _setProgressBar: function(page) {

                switch (page) {
                    case 'home':
                        this.$.appscoHomePage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'application':
                        this.$.appscoApplicationPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'account':
                        this.$.appscoAccountPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'vault':
                        this.$.appscoVaultPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'applications':
                        this.$.appscoApplicationsPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'company-home':
                        this.$.appscoCompanyHomePage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'manage-application':
                        this.$.appscoManageApplicationPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'directory':
                        this.$.appscoDirectoryPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'manage-account':
                        this.$.appscoManageAccountPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'audit-log':
                        this.$.appscoAuditLogPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'provisioning':
                        this.$.appscoProvisioningPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'provisioning-settings':
                        this.$.appscoProvisioningSettingsPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'provisioning-integration-authorization-success':
                        this.$.appscoProvisioningIntegrationSuccessPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    case 'provisioning-integration-authorization-failed':
                        this.$.appscoProvisioningIntegrationFailedPage.pageLoaded ? this._hideProgressBar() : this._showProgressBar();
                        break;

                    default:
                        this._hideProgressBar();
                }

            },

            _onPageLoaded: function() {
                this._hideProgressBar();
            },

            _showProgressBar: function() {
                this.$.pageProgress.hidden = false;
            },

            _hideProgressBar: function() {

                setTimeout(function() {
                    this.$.pageProgress.hidden = true;
                }.bind(this), 1000);

            },

            _computeCompany: function(page) {
                return (
                        page === 'company-home' ||
                        page === 'applications' ||
                        page === 'manage-application' ||
                        page === 'directory' ||
                        page === 'manage-account' ||
                        page === 'statistics' ||
                        page === 'provisioning' ||
                        page === 'provisioning-settings' ||
                        page === 'provisioning-integration-authorization-success' ||
                        page === 'provisioning-integration-authorization-failed' ||
                        page === 'billing' ||
                        page === 'company' ||
                        page === 'audit-log');
            },

            _computePanel: function(company) {
                return company ? 'appsco-business-product' : 'appsco-product';
            },

            _computeBrandLogo: function(company, companyPage) {
                if (companyPage && company.company && company.company.image) {
                    return company.company.image;
                }

                return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAgCAYAAAB+ZAqzAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAVZJREFUeNrsmOENgjAQhcE4AG5QN2AERnCEjsAIdQJG6AiO0BEcATdwhLONxJR6V1u8Ij98ycXkrL3HR+8gVlWCAEDa0EjuaqP1csLGkPJ7FtlNR3hKIzknNeV0uC5YqzhNSc/AiORgKiyCnCbWSm5ar02DHEzFhyB3J9aCf/tL02qckSCvbHSAy60Va9BSSGFn1gAt1zjNlmj5Mr+gdYE0aXZahFmFdOgnSW5aEikivHmWo1NJWnoBLf8ItFujNWumErSwDs3V+xjJoNURtBTwSC6lZQrRmtXhoNXa6IFPIwctE3lYf3crv6TVER26Ki29RVpiNVoJkz+FlmGnlTD5Y7ROia82q9Iat0ALG5xyml3laUXMqkSKZWgRpiha4k+LMPYzWvuYsbquDxhFxn8fzmTt3DNnP9xVNgymbvbCj9SXu8zNeiZTUVocZ27pe/3HA/8QYABzJAP50CmRFwAAAABJRU5ErkJggg==";
            },

            _computeBrandTitle: function(company, companyPage) {
                if (!companyPage) {
                    return 'AppsCo';
                }

                return '';
            },

            _setAccountCompany: function(company) {
                var newCompany = JSON.parse(JSON.stringify(this.currentCompany)),
                    companies = JSON.parse(JSON.stringify(this.account.companies)),
                    length = companies.length;

                newCompany.company = company;
                this.currentCompany = newCompany;

                for (var i = 0; i < length; i++) {
                    if (company.alias === companies[i].company.alias) {
                        companies[i].company = company;
                        break;
                    }
                }

                this.set('account.companies', []);
                this.set('account.companies', companies);
            },

            _onPageAnimationFinish: function(event) {
                var fromPage = event.detail.fromPage,
                    toPage = event.detail.toPage;

                switch (fromPage.getAttribute('name')) {

                    case 'home':
                        if (fromPage.$) {
                            this.applicationsApi = this.api.icons;
                            fromPage.resetPage();
                        }

                        break;

                    case 'application':
                    case 'account':
                    case 'company-home':
                    case 'applications':
                    case 'manage-application':
                    case 'directory':
                    case 'manage-account':
                    case 'audit-log':
                    case 'provisioning-settings':
                    case 'company':

                        if (fromPage.$) {
                            fromPage.resetPage();
                        }

                        break;

                    default:
                        break;
                }

                switch (toPage.getAttribute('name')) {
                    case 'home':
                    case 'company-home':
                    case 'applications':
                    case 'provisioning-settings':

                        if (toPage.$) {
                            toPage.initializePage();
                        }

                        break;

                    case 'directory':

                        if (toPage.$) {
                            toPage.setDefaultAccount();
                        }

                        break;

                    case 'audit-log':

                        if (toPage.$) {
                            toPage.reloadLog();
                        }

                        break;

                    case 'statistics':

                        if (toPage.$) {
                            toPage.reloadStatistics();
                        }

                        break;

                    default:
                        break;
                }

            },

            _onPageActionsAnimationFinish: function(event) {
                var fromPage = event.detail.fromPage;

                switch (fromPage.getAttribute('name')) {

                    case 'home':
                    case 'applications':
                    case 'directory':

                        if (fromPage.$) {
                            fromPage.resetPage();
                        }

                        break;

                    default:
                        break;
                }
            },

            _notifyAccountLog: function() {
                this.fire('reload-account-log');
            },

            _notifyReloadApplications: function() {
                this.fire('reload-applications');
            },

            _notifyReloadAccounts: function() {
                this.fire('reload-accounts');
            },

            _notify: function(message, persistant) {
                var toast = this.$.toast;

                this._toastPersistence = persistant;
                toast.duration = persistant ? 0 : 3000;

                if (toast.opened) {
                    toast.cancel();
                    this._toastMessage = message;
                }
                else {
                    this._toastMessage = message;
                    toast.open();
                }
            },

            _onCloseToastAction: function() {
                this.$.toast.close();
            },

            _onToastMessageClosed: function(event) {
                if (event.detail.canceled) {
                    this.$.toast.open();
                }
            },

            _onError: function(event) {
                this._showPage404();
            },

            _getCookie: function(cookieName) {
                var name = cookieName + '=',
                    decodedCookie = decodeURIComponent(document.cookie),
                    cookies = decodedCookie.split(';');

                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i];

                    while (cookie.charAt(0) == ' ') {
                        cookie = cookie.substring(1);
                    }

                    if (cookie.indexOf(name) == 0) {
                        return cookie.substring(name.length, cookie.length);
                    }
                }

                return '';
            },

            _changeTheme: function(companyPage, currentCompany) {
                var company = currentCompany.company ? currentCompany.company : {};

                if (companyPage) {

                    if (company.primary_color) {

                        this.customStyle['--header-background-color'] = company.primary_color;

                        if ('#fff' != company.primary_color && '#ffffff' != company.primary_color) {
                            this.customStyle['--brand-color'] = company.primary_color;
                        }
                        else {
                            this.customStyle['--brand-color'] = 'var(--app-primary-color)';
                        }
                    }
                    else {
                        this.customStyle['--header-background-color'] = 'var(--app-primary-color)';
                        this.customStyle['--brand-color'] = 'var(--app-primary-color)';
                    }

                    if (company.secondary_color) {
                        this.customStyle['--brand-text-color'] = company.secondary_color;
                        this.customStyle['--header-text-color'] = company.secondary_color;
                    }
                    else {
                        this.customStyle['--brand-text-color'] = 'var(--brand-default-text-color)';
                        this.customStyle['--header-text-color'] = 'var(--brand-default-text-color)';
                    }
                }
                else {
                    this.customStyle['--header-background-color'] = 'var(--app-primary-color)';
                    this.customStyle['--header-text-color'] = 'var(--brand-default-text-color)';
                    this.customStyle['--brand-color'] = 'var(--app-primary-color)';
                    this.customStyle['--brand-text-color'] = 'var(--brand-default-text-color)';
                }

                this.updateStyles();
            },

            _onCopiedApplicationAttribute: function(event) {
                var appRequest = document.createElement('iron-request'),
                        application = event.detail.application.application;

                if (!!application.company) {
                    appRequest.send({
                        url: application.self + '/track-events',
                        method: 'POST',
                        handleAs: 'json',
                        body: 'track_events[event_type] = copy_event&track_events[field]=' + encodeURIComponent(event.detail.attribute),
                        headers: {
                            'Authorization': 'token ' + this.authorizationToken,
                            'Content-Type': 'application/x-www-form-urlencoded'
                        }
                    });
                }
            }

            /**
             * Global END
             */
        });
    </script>
</dom-module>
